<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python 2024 - 5&nbsp; Data Science (Intermediate)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./600-mod6.html" rel="next">
<link href="./400-mod4.html" rel="prev">
<link href="./images/nda.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="epub.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./400-mod4.html">Intermediate</a></li><li class="breadcrumb-item"><a href="./500-mod5.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Science (Intermediate)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Python 2024</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://git.ine.pt/nda/formacao/python2024" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-git"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Python-2024.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Python-2024.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programação em Python</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basic</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100-mod1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Programming Tecnhiques (Basics)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./200-mod2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Science (Basics)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./300-mod3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Jupyter e Visualizações (Basics)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Intermediate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./400-mod4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programming Tecnhiques (Intermediate)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./500-mod5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Science (Intermediate)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./600-mod6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualização de Dados Geográficos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Advanced</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./700-mod7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Módulo 7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./800-mod8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Módulo 8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./900-mod9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Módulo 9</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#exploração-com-pandas" id="toc-exploração-com-pandas" class="nav-link active" data-scroll-target="#exploração-com-pandas"><span class="header-section-number">5.1</span> Exploração com Pandas</a>
  <ul class="collapse">
  <li><a href="#series" id="toc-series" class="nav-link" data-scroll-target="#series"><span class="header-section-number">5.1.1</span> Series</a></li>
  <li><a href="#dataframes" id="toc-dataframes" class="nav-link" data-scroll-target="#dataframes"><span class="header-section-number">5.1.2</span> DataFrames</a></li>
  <li><a href="#index" id="toc-index" class="nav-link" data-scroll-target="#index"><span class="header-section-number">5.1.3</span> Index</a></li>
  <li><a href="#reorganizar-as-dataframes" id="toc-reorganizar-as-dataframes" class="nav-link" data-scroll-target="#reorganizar-as-dataframes"><span class="header-section-number">5.1.4</span> Reorganizar as DataFrames</a></li>
  </ul></li>
  <li><a href="#estatisticas-oficiais" id="toc-estatisticas-oficiais" class="nav-link" data-scroll-target="#estatisticas-oficiais"><span class="header-section-number">5.2</span> Estatisticas Oficiais</a>
  <ul class="collapse">
  <li><a href="#pre-processamento" id="toc-pre-processamento" class="nav-link" data-scroll-target="#pre-processamento"><span class="header-section-number">5.2.1</span> Pre-processamento</a></li>
  <li><a href="#gravar-os-dados" id="toc-gravar-os-dados" class="nav-link" data-scroll-target="#gravar-os-dados"><span class="header-section-number">5.2.2</span> Gravar os dados</a></li>
  </ul></li>
  <li><a href="#introdução-a-machine-learning" id="toc-introdução-a-machine-learning" class="nav-link" data-scroll-target="#introdução-a-machine-learning"><span class="header-section-number">5.3</span> Introdução a Machine Learning</a>
  <ul class="collapse">
  <li><a href="#regressão" id="toc-regressão" class="nav-link" data-scroll-target="#regressão"><span class="header-section-number">5.3.1</span> Regressão</a></li>
  <li><a href="#classificação" id="toc-classificação" class="nav-link" data-scroll-target="#classificação"><span class="header-section-number">5.3.2</span> Classificação</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-git"></i></div><div class="action-links"><p><a href="https://git.ine.pt/nda/formacao/python2024/edit/main/500-mod5.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Science (Intermediate)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conteúdos
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conceitos de <em>Data Science</em> com <code>Pandas</code> e <code>Scikit</code>.</p>
<p>Manipulação de dataFrames para extrair, filtrar e transformar conjuntos de dados.</p>
<p>Introdução a aprendizagem supervisionada (Regressão e Classificação).</p>
</div>
</div>
<section id="exploração-com-pandas" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="exploração-com-pandas"><span class="header-section-number">5.1</span> Exploração com Pandas</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usamos por convenção np para Numpy</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># usamos por convenção pd para Pandas</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="series" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="series"><span class="header-section-number">5.1.1</span> Series</h3>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.Series([<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>])</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>0    0.25
1    0.50
2    0.75
3    1.00
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data.values</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>RangeIndex(start=0, stop=4, step=1)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> data[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.Series([<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>],</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 index<span class="op">=</span>[<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>a    0.25
b    0.50
c    0.75
d    1.00
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>population_dict <span class="op">=</span> {<span class="st">'Lisboa'</span>: <span class="dv">544325</span>,<span class="st">'Sintra'</span>: <span class="dv">385989</span>, <span class="st">'Vila Nova de Gaia'</span>: <span class="dv">304233</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Porto'</span>: <span class="dv">231834</span>, <span class="st">'Cascais'</span>: <span class="dv">214239</span>, <span class="st">'Loures'</span>: <span class="dv">201349</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Braga'</span>: <span class="dv">193324</span>, <span class="st">'Almada'</span>: <span class="dv">177943</span>}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> pd.Series(population_dict)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>population</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Lisboa               544325
Sintra               385989
Vila Nova de Gaia    304233
Porto                231834
Cascais              214239
Loures               201349
Braga                193324
Almada               177943
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>population[<span class="st">'Braga'</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>population[<span class="st">'Braga'</span>] <span class="op">=</span> <span class="dv">201000</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>population[<span class="st">'Braga'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>201000</code></pre>
</div>
</div>
</section>
<section id="dataframes" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="dataframes"><span class="header-section-number">5.1.2</span> DataFrames</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>area_dict <span class="op">=</span> {<span class="st">'Lisboa'</span>: <span class="fl">100.1</span>,<span class="st">'Sintra'</span>: <span class="fl">23.8</span>, <span class="st">'Vila Nova de Gaia'</span>: <span class="fl">56.3</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Porto'</span>: <span class="fl">41.4</span>, <span class="st">'Cascais'</span>: <span class="fl">97.1</span>, <span class="st">'Loures'</span>: <span class="fl">11.8</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Braga'</span>: <span class="dv">41</span>, <span class="st">'Almada'</span>: <span class="fl">14.7</span>}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>area <span class="op">=</span> pd.Series(area_dict)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Lisboa               100.1
Sintra                23.8
Vila Nova de Gaia     56.3
Porto                 41.4
Cascais               97.1
Loures                11.8
Braga                 41.0
Almada                14.7
dtype: float64</code></pre>
</div>
</div>
<p>criar uma fataframe a partir de series:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> pd.DataFrame({<span class="st">'population'</span>: population,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'area'</span>: area})</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>544325</td>
<td>100.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>385989</td>
<td>23.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Porto</td>
<td>231834</td>
<td>41.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>214239</td>
<td>97.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Loures</td>
<td>201349</td>
<td>11.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>201000</td>
<td>41.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>177943</td>
<td>14.7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset index com o nome cidade</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cities.reset_index()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="index" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="index"><span class="header-section-number">5.1.3</span> Index</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>indA <span class="op">=</span> pd.Index([<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>])</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>indA</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>indB <span class="op">=</span> pd.Index([<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>indA.intersection(indB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Index([3, 5, 7], dtype='int64')</code></pre>
</div>
</div>
<p>a intersecção é muito útil para descobrirmos registos com a mesma identificação em vários conjuntos</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>aerod_dict <span class="op">=</span> {<span class="st">'Lisboa'</span>: <span class="dv">3</span>, <span class="st">'Porto'</span>: <span class="dv">4</span>, <span class="st">'Cascais'</span>: <span class="dv">1</span>, <span class="st">'Braga'</span>: <span class="dv">7</span>, <span class="st">'Viseu'</span>: <span class="dv">2</span>}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>aerod <span class="op">=</span> pd.Series(aerod_dict)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>aerod.index</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>aerod.index.intersection(cities.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Index(['Lisboa', 'Porto', 'Cascais', 'Braga'], dtype='object')</code></pre>
</div>
</div>
</section>
<section id="reorganizar-as-dataframes" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="reorganizar-as-dataframes"><span class="header-section-number">5.1.4</span> Reorganizar as DataFrames</h3>
<p>Para juntar duas dataframes podemos usar os métodos: + Concatenate (<code>pd.concat()</code>) + Append (<code>df.append</code>): <em>As of pandas 2.0, append (previously deprecated) was removed</em> + Merge (<code>pd.merge()</code>)</p>
<p>Por conveniência vamos definir uma função para criar dataframes</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_df(cols, ind):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Quickly make a DataFrame"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {c: [<span class="bu">str</span>(c) <span class="op">+</span> <span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> ind]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> cols}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(data, ind)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># exemplo de DataFrame</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>make_df(<span class="st">'ABC'</span>, <span class="bu">range</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A0</td>
<td>B0</td>
<td>C0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A2</td>
<td>B2</td>
<td>C2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="método-concatenate" class="level4" data-number="5.1.4.1">
<h4 data-number="5.1.4.1" class="anchored" data-anchor-id="método-concatenate"><span class="header-section-number">5.1.4.1</span> Método concatenate</h4>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> make_df(<span class="st">'AB'</span>, [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> make_df(<span class="st">'AB'</span>, np.arange(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>A3</td>
<td>B3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>A4</td>
<td>B4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df1, df2])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>A3</td>
<td>B3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>A4</td>
<td>B4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> make_df(<span class="st">'AB'</span>, <span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> make_df(<span class="st">'CD'</span>, <span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df3 </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>df4</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>pd.concat([df3, df4], axis<span class="op">=</span><span class="st">'columns'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A0</td>
<td>B0</td>
<td>C0</td>
<td>D0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>D1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Duplicação de indexes</p>
<p>(Uma diferença importante entre np.concatenate e pd.concat é que a concatenação do Pandas preserva os índices, mesmo que o resultado tenha índices duplicados.)</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> make_df(<span class="st">'AB'</span>, [<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> make_df(<span class="st">'AB'</span>, [<span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>y.index <span class="op">=</span> x.index  <span class="co"># fazer o match dos indices</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>pd.concat([x, y])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A0</td>
<td>B0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A3</td>
<td>B3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tratar índices repetidos como um erro, fazendo apenas a verificação</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    pd.concat([x, y], verify_integrity<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"ValueError:"</span>, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ValueError: Indexes have overlapping values: Index([0, 1], dtype='int64')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignorando o index das dataframes de origem, e refazendo na nova dataframe o index</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>pd.concat([x, y], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A0</td>
<td>B0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>A3</td>
<td>B3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando chaves MultiIndex para especificar um rótulo para as fontes de dados</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>pd.concat([x, y], keys<span class="op">=</span>[<span class="st">'x'</span>, <span class="st">'y'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">x</td>
<td data-quarto-table-cell-role="th">0</td>
<td>A0</td>
<td>B0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">y</td>
<td data-quarto-table-cell-role="th">0</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A3</td>
<td>B3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>teste <span class="op">=</span> pd.concat([x, y], keys<span class="op">=</span>[<span class="st">'x'</span>, <span class="st">'y'</span>])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>teste.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">level_0</th>
<th data-quarto-table-cell-role="th">level_1</th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>x</td>
<td>0</td>
<td>A0</td>
<td>B0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>x</td>
<td>1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>y</td>
<td>0</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>y</td>
<td>1</td>
<td>A3</td>
<td>B3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Concatenação com joins</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> make_df(<span class="st">'ABC'</span>, [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> make_df(<span class="st">'BCD'</span>, [<span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>df5</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>df6</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>pd.concat([df5, df6])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>A1</td>
<td>B1</td>
<td>C1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>A2</td>
<td>B2</td>
<td>C2</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>B3</td>
<td>C3</td>
<td>D3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>B4</td>
<td>C4</td>
<td>D4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>para juntar fazendo a união das colunas de entrada usamos join=‘outer’, que é o valor por omissão<br>
para juntar fazendo a interseção das colunas de entrada usamos join=‘inner’</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df5, df6], join<span class="op">=</span><span class="st">'inner'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>B1</td>
<td>C1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>B2</td>
<td>C2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>B3</td>
<td>C3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>B4</td>
<td>C4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>se quisermos preservar todas as colunas de uma das dataframes devemos fazer reindex das colunas a preservar na outra dataframe axis=1</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df6, df5.reindex(df6.columns, axis<span class="op">=</span><span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>B3</td>
<td>C3</td>
<td>D3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>B4</td>
<td>C4</td>
<td>D4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>B1</td>
<td>C1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>B2</td>
<td>C2</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="método-merge" class="level4" data-number="5.1.4.2">
<h4 data-number="5.1.4.2" class="anchored" data-anchor-id="método-merge"><span class="header-section-number">5.1.4.2</span> Método merge</h4>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [ <span class="st">'Braga'</span>,<span class="st">'Lisboa'</span>,<span class="st">'Sintra'</span>, <span class="st">'Vila Nova de Gaia'</span>,<span class="st">'Porto'</span>, <span class="st">'Cascais'</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Loures'</span>, <span class="st">'Almada'</span>],</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'populacao'</span>: [ <span class="dv">193324</span>, <span class="dv">544325</span>, <span class="dv">385989</span>, <span class="dv">304233</span>, <span class="dv">231834</span>, <span class="dv">214239</span>, <span class="dv">201349</span>, <span class="dv">177943</span>]})</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Sintra'</span>, <span class="st">'Vila Nova de Gaia'</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Porto'</span>, <span class="st">'Cascais'</span>, <span class="st">'Loures'</span>, <span class="st">'Braga'</span>, <span class="st">'Almada'</span>],</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'area'</span>: [ <span class="fl">100.1</span>, <span class="fl">23.8</span>, <span class="fl">56.3</span>, <span class="fl">41.4</span>, <span class="fl">97.1</span>, <span class="fl">11.8</span>, <span class="dv">41</span>,  <span class="fl">14.7</span>],</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'nuts3'</span>: [ <span class="st">'170'</span>, <span class="st">'170'</span>, <span class="st">'11A'</span>, <span class="st">'11A'</span>, <span class="st">'170'</span>, <span class="st">'170'</span>, <span class="st">'112'</span>, <span class="st">'170'</span>]})</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Sintra</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vila Nova de Gaia</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Porto</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Cascais</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Loures</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Braga</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Almada</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>one-to-one join</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.merge(df1, df2)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>df3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>one-to-many join</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> pd.DataFrame({<span class="st">'nuts3'</span>: [ <span class="st">'112'</span>, <span class="st">'11A'</span>, <span class="st">'170'</span>],</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'nuts3_dsg'</span>: [<span class="st">'Cávado'</span>, <span class="st">'Área Met. Porto'</span>, <span class="st">'Área Met. Lisboa'</span>]})</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> pd.merge(df3, df4)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>df4</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>df5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>many-to-many join</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> pd.DataFrame({<span class="st">'nuts3'</span>: [ <span class="st">'112'</span>, <span class="st">'112'</span>,<span class="st">'11A'</span>, <span class="st">'170'</span>],</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'class'</span>: [<span class="st">'Urbano'</span>, <span class="st">'Rural'</span>,<span class="st">'Urbano'</span>, <span class="st">'Urbano'</span>]})</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>df6</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>pd.merge(df5, df6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
<th data-quarto-table-cell-role="th">class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
<td>Urbano</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
<td>Rural</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>Urbano</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>Urbano</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>Urbano</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>Urbano</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>Urbano</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
<td>Urbano</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
<td>Área Met. Porto</td>
<td>Urbano</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>merge key</p>
<p>podemos indicar a chave para ligar, o primeiro exemplo é equivalente a display(‘df1’, ‘df2’, “pd.merge(df1, df2, on=‘cidade’)”)</p>
<p>mas nem sempre as colunas por onde queremos fazer o join têm o mesmo nome, nesse caso podemos usar o left_on e o right_on</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df1a <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Sintra'</span>, <span class="st">'Vila Nova de Gaia'</span>,<span class="st">'Porto'</span>, <span class="st">'Cascais'</span>, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Loures'</span>, <span class="st">'Braga'</span>, <span class="st">'Almada'</span>],</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'populacao'</span>: [<span class="dv">544325</span>, <span class="dv">385989</span>, <span class="dv">304233</span>, <span class="dv">231834</span>, <span class="dv">214239</span>, <span class="dv">201349</span>, <span class="dv">193324</span>, <span class="dv">177943</span>]})</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df2a <span class="op">=</span> pd.DataFrame({<span class="st">'cidade+100khab'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Sintra'</span>, <span class="st">'Vila Nova de Gaia'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Porto'</span>, <span class="st">'Cascais'</span>, <span class="st">'Loures'</span>, <span class="st">'Braga'</span>, <span class="st">'Almada'</span>],</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'area'</span>: [ <span class="fl">100.1</span>, <span class="fl">23.8</span>, <span class="fl">56.3</span>, <span class="fl">41.4</span>, <span class="fl">97.1</span>, <span class="fl">11.8</span>, <span class="dv">41</span>,  <span class="fl">14.7</span>],</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'nuts3'</span>: [ <span class="st">'170'</span>, <span class="st">'170'</span>, <span class="st">'11A'</span>, <span class="st">'11A'</span>, <span class="st">'170'</span>, <span class="st">'170'</span>, <span class="st">'112'</span>, <span class="st">'170'</span>]})</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>df1a</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>df2a</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>pd.merge(df1a, df2a, left_on<span class="op">=</span><span class="st">"cidade"</span>, right_on<span class="op">=</span><span class="st">"cidade+100khab"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">cidade+100khab</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>544325</td>
<td>Lisboa</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Sintra</td>
<td>385989</td>
<td>Sintra</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
<td>Vila Nova de Gaia</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Porto</td>
<td>231834</td>
<td>Porto</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Cascais</td>
<td>214239</td>
<td>Cascais</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Loures</td>
<td>201349</td>
<td>Loures</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Braga</td>
<td>193324</td>
<td>Braga</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Almada</td>
<td>177943</td>
<td>Almada</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>podemos fazer drop da coluna repetida</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.merge(df1a, df2a, left_on<span class="op">=</span><span class="st">"cidade"</span>, right_on<span class="op">=</span><span class="st">"cidade+100khab"</span>).drop(<span class="st">'cidade+100khab'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Left_index e Right_index Keywords</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df1i <span class="op">=</span> df1.set_index(<span class="st">'cidade'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df2i <span class="op">=</span> df2.set_index(<span class="st">'cidade'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>df1i</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>df2i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Porto</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Loures</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pd.merge(df1i, df2i, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>quando temos os indices dos dois lados podemos usar apenas o join</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># método antigo</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df1i.join(df2i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>as keywords left_index e right_index são mais úteis quando pretendemos misturar index e colunas</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pd.merge(df1i, df2a, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">'cidade+100khab'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">cidade+100khab</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>193324</td>
<td>Braga</td>
<td>41.0</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>544325</td>
<td>Lisboa</td>
<td>100.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>385989</td>
<td>Sintra</td>
<td>23.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>304233</td>
<td>Vila Nova de Gaia</td>
<td>56.3</td>
<td>11A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>231834</td>
<td>Porto</td>
<td>41.4</td>
<td>11A</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>214239</td>
<td>Cascais</td>
<td>97.1</td>
<td>170</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>201349</td>
<td>Loures</td>
<td>11.8</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>177943</td>
<td>Almada</td>
<td>14.7</td>
<td>170</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># para fazer reset de um index</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df1i</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df1i.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Braga</td>
<td>193324</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Lisboa</td>
<td>544325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sintra</td>
<td>385989</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Porto</td>
<td>231834</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Cascais</td>
<td>214239</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Loures</td>
<td>201349</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Almada</td>
<td>177943</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posso continuar a fazer reset do index</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># isso irá acrescentando colunas</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>df1i.reset_index(inplace <span class="op">=</span> <span class="va">True</span>) <span class="co"># o 'inplace = True' altera o dataframe original </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>df1i</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>df1i.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>Braga</td>
<td>193324</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Lisboa</td>
<td>544325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>Sintra</td>
<td>385989</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>Vila Nova de Gaia</td>
<td>304233</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>Porto</td>
<td>231834</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>5</td>
<td>Cascais</td>
<td>214239</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>6</td>
<td>Loures</td>
<td>201349</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>Almada</td>
<td>177943</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Inner e Outer Joins</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df11 <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Sintra'</span>],</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'populacao'</span>: [<span class="dv">544325</span>, <span class="dv">385989</span>]})</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>df12 <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Porto'</span>, ],</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'area'</span>: [ <span class="fl">100.1</span>, <span class="fl">97.1</span>]})</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>df11</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>df12</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>pd.merge(df11, df12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>por omissão é realizado o inner join mas podemos especificar o tipo de join</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pd.merge(df11, df12, how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>() <span class="co"># paenas para acrescentr uma linha vazia</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>pd.merge(df11, df12, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>544325</td>
<td>100.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Sintra</td>
<td>385989</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Sobreposição de Nomes de Colunas</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df13 <span class="op">=</span> pd.DataFrame({<span class="st">'cidade'</span>: [<span class="st">'Lisboa'</span>,<span class="st">'Porto'</span>],</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'area'</span>: [ <span class="dv">100</span>, <span class="fl">97.5</span>]})</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>df12</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>df13</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>pd.merge(df12, df13, on<span class="op">=</span><span class="st">'cidade'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">area_x</th>
<th data-quarto-table-cell-role="th">area_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>100.1</td>
<td>100.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Porto</td>
<td>97.1</td>
<td>97.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>podemos indicar os sufixos que prentedemos para conhecermos a origem</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pd.merge(df12, df13, on<span class="op">=</span><span class="st">"cidade"</span>, suffixes<span class="op">=</span>[<span class="st">"_12"</span>, <span class="st">"_13"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">area_12</th>
<th data-quarto-table-cell-role="th">area_13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lisboa</td>
<td>100.1</td>
<td>100.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Porto</td>
<td>97.1</td>
<td>97.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="agregar-e-agrupar" class="level4" data-number="5.1.4.3">
<h4 data-number="5.1.4.3" class="anchored" data-anchor-id="agregar-e-agrupar"><span class="header-section-number">5.1.4.3</span> Agregar e Agrupar</h4>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df5</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>df5.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>8.000000</td>
<td>8.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>281654.500000</td>
<td>48.275000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>126731.169791</td>
<td>34.415601</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>177943.000000</td>
<td>11.800000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>199342.750000</td>
<td>21.525000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>223036.500000</td>
<td>41.200000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>324672.000000</td>
<td>66.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>544325.000000</td>
<td>100.100000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df5[<span class="st">'populacao'</span>].<span class="bu">sum</span>(), df5[<span class="st">'populacao'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2253236 281654.5</code></pre>
</div>
</div>
<p>valores agrupados</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>).populacao.mean()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ou de forma equivalente</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>)[<span class="st">'populacao'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>nuts3
112    193324.0
11A    268033.5
170    304769.0
Name: populacao, dtype: float64</code></pre>
</div>
</div>
<p>o object <code>groupby</code> suporta iteração sobre os grupos, isto pode ser útil para inspeccionarmos manualmente os grupos</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspecao da estrutura</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (group_name, group_data) <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="sc">{0}</span><span class="st"> shape=</span><span class="sc">{1}</span><span class="st">"</span>.<span class="bu">format</span>(group_name, group_data.shape))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>112 shape=(1, 5)
11A shape=(2, 5)
170 shape=(5, 5)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary statistics por grupo</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Nuts3:"</span>, group_name)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean value:"</span>, group_data[<span class="st">'populacao'</span>].mean())</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Median value:"</span>, group_data[<span class="st">'populacao'</span>].median())</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Standard deviation:"</span>, group_data[<span class="st">'populacao'</span>].std())</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nuts3: 112
Mean value: 193324.0
Median value: 193324.0
Standard deviation: nan

Nuts3: 11A
Mean value: 268033.5
Median value: 268033.5
Standard deviation: 51193.82385112486

Nuts3: 170
Mean value: 304769.0
Median value: 214239.0
Standard deviation: 157289.52373886824
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspeccionar valores unicos</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Category:"</span>, group_name)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Unique values:"</span>, group_data[<span class="st">'cidade'</span>].count())</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Unique values:"</span>, group_data[<span class="st">'cidade'</span>].nunique())</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Unique values:"</span>, group_data[<span class="st">'cidade'</span>].unique())</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Category: 112
Unique values: 1
Unique values: 1
Unique values: ['Braga']

Category: 11A
Unique values: 2
Unique values: 2
Unique values: ['Vila Nova de Gaia' 'Porto']

Category: 170
Unique values: 5
Unique values: 5
Unique values: ['Lisboa' 'Sintra' 'Cascais' 'Loures' 'Almada']
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspeccionar os tops</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Category:"</span>, group_name)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(group_data.nlargest(N, <span class="st">'area'</span>))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Category: 112
  cidade  populacao  area nuts3 nuts3_dsg
0  Braga     193324  41.0   112    Cávado

Category: 11A
              cidade  populacao  area nuts3        nuts3_dsg
6  Vila Nova de Gaia     304233  56.3   11A  Área Met. Porto

Category: 170
   cidade  populacao   area nuts3         nuts3_dsg
1  Lisboa     544325  100.1   170  Área Met. Lisboa
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspecao visual</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Category:"</span>, group_name)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(group_data.head())</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Category: 112
  cidade  populacao  area nuts3 nuts3_dsg
0  Braga     193324  41.0   112    Cávado

Category: 11A
              cidade  populacao  area nuts3        nuts3_dsg
6  Vila Nova de Gaia     304233  56.3   11A  Área Met. Porto
7              Porto     231834  41.4   11A  Área Met. Porto

Category: 170
    cidade  populacao   area nuts3         nuts3_dsg
1   Lisboa     544325  100.1   170  Área Met. Lisboa
2   Sintra     385989   23.8   170  Área Met. Lisboa
3  Cascais     214239   97.1   170  Área Met. Lisboa
4   Loures     201349   11.8   170  Área Met. Lisboa
5   Almada     177943   14.7   170  Área Met. Lisboa
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filtrar grupos</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> group_data[<span class="st">'area'</span>].<span class="bu">max</span>() <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Categorias com area &gt; 100:"</span>, group_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Categorias com area &gt; 100: 170</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar visualizacoes por grupo</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>df5.set_index(<span class="st">'cidade'</span>, inplace <span class="op">=</span> <span class="va">True</span> )</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group_data <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    group_data[<span class="st">'populacao'</span>].plot(kind<span class="op">=</span><span class="st">'bar'</span>, title<span class="op">=</span>group_name)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-51-output-1.png" width="600" height="476"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-51-output-2.png" width="600" height="555"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-51-output-3.png" width="600" height="487"></p>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># para aplicar funcao dentro do grupo</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate percentage change within each group</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_relative_percentage(group,col_name):</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    total_sum <span class="op">=</span> group[col_name].<span class="bu">sum</span>()</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    group[<span class="st">'relative_percentage'</span>] <span class="op">=</span> (group[col_name] <span class="op">/</span> total_sum) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the custom analysis to each group</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, group <span class="kw">in</span> df5.groupby(<span class="st">'nuts3'</span>):</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    group <span class="op">=</span> calculate_relative_percentage(group, <span class="st">'populacao'</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> pd.concat([result_df, group])</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
<th data-quarto-table-cell-role="th">relative_percentage</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>193324</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
<td>56.752794</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Porto</td>
<td>231834</td>
<td>41.4</td>
<td>11A</td>
<td>Área Met. Porto</td>
<td>43.247206</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>35.720497</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>25.329938</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>14.059107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>13.213221</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
<td>11.677238</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>)[<span class="st">'populacao'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>1.0</td>
<td>193324.0</td>
<td>NaN</td>
<td>193324.0</td>
<td>193324.00</td>
<td>193324.0</td>
<td>193324.00</td>
<td>193324.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11A</td>
<td>2.0</td>
<td>268033.5</td>
<td>51193.823851</td>
<td>231834.0</td>
<td>249933.75</td>
<td>268033.5</td>
<td>286133.25</td>
<td>304233.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>5.0</td>
<td>304769.0</td>
<td>157289.523739</td>
<td>177943.0</td>
<td>201349.00</td>
<td>214239.0</td>
<td>385989.00</td>
<td>544325.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Funções de Agregação</p>
<p>varias funções de agregação podem ser aplicadas em simultâneo</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>)[<span class="st">'populacao'</span>].aggregate([<span class="st">"min"</span>, <span class="st">"median"</span>, <span class="st">"mean"</span>, <span class="st">"max"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>193324</td>
<td>193324.0</td>
<td>193324.0</td>
<td>193324</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11A</td>
<td>231834</td>
<td>268033.5</td>
<td>268033.5</td>
<td>304233</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>177943</td>
<td>214239.0</td>
<td>304769.0</td>
<td>544325</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Utilização de filtros</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_func(x):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Defino a função de filtro"""</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="st">'populacao'</span>].std() <span class="op">&gt;</span> <span class="dv">100000</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># a função de filtro é aplicado ao grupo</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>).<span class="bu">filter</span>(filter_func)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>544325</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>385989</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>214239</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Loures</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Almada</td>
<td>177943</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>)[<span class="st">'populacao'</span>].std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>nuts3
112              NaN
11A     51193.823851
170    157289.523739
Name: populacao, dtype: float64</code></pre>
</div>
</div>
<p>Também é comum passar as colunas de mapeamento dum dicionário para operações a serem aplicadas nessa coluna</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>).aggregate({<span class="st">'populacao'</span>: <span class="st">'min'</span>, <span class="st">'area'</span>: <span class="st">'max'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>193324</td>
<td>41.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11A</td>
<td>231834</td>
<td>56.3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>177943</td>
<td>100.1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Método Transform (conserva o nr de linhas original)</p>
<p>Na transformação, a saída tem o mesmo formato da entrada</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> center(x):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">-</span> x.mean()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>df5</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>)[<span class="st">'populacao'</span>].transform(center)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>cidade
Braga                     0.0
Lisboa               239556.0
Sintra                81220.0
Cascais              -90530.0
Loures              -103420.0
Almada              -126826.0
Vila Nova de Gaia     36199.5
Porto                -36199.5
Name: populacao, dtype: float64</code></pre>
</div>
</div>
<p>Método Apply</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> norm_by_area(x):</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x is a DataFrame of group values</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    x[<span class="st">'populacao'</span>] <span class="op">/=</span> x[<span class="st">'area'</span>].<span class="bu">sum</span>()</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'nuts3'</span>).<span class="bu">apply</span>(norm_by_area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td data-quarto-table-cell-role="th">Braga</td>
<td>4715.219512</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">11A</td>
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>3113.950870</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Porto</td>
<td>2372.917093</td>
<td>41.4</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
<tr class="even">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">170</td>
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>2199.292929</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>1559.551515</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>865.612121</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td>813.531313</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>718.961616</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># com o group by por nuts3 somam-se as áreas da nuts3 </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># por exemplo na 11A será 56.3 + 41.4 = 97.7</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># como pop VNGaia = 304233 Porto = 231834 </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pop normalizada por nuts3 de </span><span class="sc">{0}</span><span class="st"> é </span><span class="sc">{1}</span><span class="st">"</span>. <span class="bu">format</span>(<span class="st">"VNGaia"</span>, <span class="dv">304233</span><span class="op">/</span><span class="fl">97.7</span>))</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pop normalizada por nuts3 de </span><span class="sc">{0}</span><span class="st"> é </span><span class="sc">{1}</span><span class="st">"</span>. <span class="bu">format</span>(<span class="st">"Porto"</span>, <span class="dv">231834</span><span class="op">/</span><span class="fl">97.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pop normalizada por nuts3 de VNGaia é 3113.950870010235
Pop normalizada por nuts3 de Porto é 2372.9170931422723</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df5.groupby(<span class="st">'cidade'</span>).<span class="bu">apply</span>(norm_by_area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Almada</td>
<td data-quarto-table-cell-role="th">Almada</td>
<td>12104.965986</td>
<td>14.7</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Braga</td>
<td data-quarto-table-cell-role="th">Braga</td>
<td>4715.219512</td>
<td>41.0</td>
<td>112</td>
<td>Cávado</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cascais</td>
<td data-quarto-table-cell-role="th">Cascais</td>
<td>2206.374871</td>
<td>97.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>5437.812188</td>
<td>100.1</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td data-quarto-table-cell-role="th">Loures</td>
<td>17063.474576</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Porto</td>
<td data-quarto-table-cell-role="th">Porto</td>
<td>5599.855072</td>
<td>41.4</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td data-quarto-table-cell-role="th">Sintra</td>
<td>16218.025210</td>
<td>23.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>5403.783304</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># com o group by por cidade não há lugar a somas... </span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># as áreas são VNGaia = 56.3 Porto = 41.4 </span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># como pop VNGaia = 304233 Porto = 231834 </span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pop normalizada por cidade de</span><span class="sc">{0}</span><span class="st"> é </span><span class="sc">{1}</span><span class="st">"</span>. <span class="bu">format</span>(<span class="st">"VNGaia"</span>, <span class="dv">304233</span><span class="op">/</span><span class="fl">56.3</span>))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pop normalizada por cidade de</span><span class="sc">{0}</span><span class="st"> é </span><span class="sc">{1}</span><span class="st">"</span>. <span class="bu">format</span>(<span class="st">"Porto"</span>, <span class="dv">231834</span><span class="op">/</span><span class="fl">41.4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pop normalizada por cidade deVNGaia é 5403.783303730018
Pop normalizada por cidade dePorto é 5599.855072463768</code></pre>
</div>
</div>
<p>Diferenças entre Apply e Transform</p>
<ul>
<li>transform() pode receber uma função, uma função de string, uma lista de funções e um dicionário. No entanto, apply() só é pode receber uma função.<br>
</li>
<li>transform() não pode produzir resultados agregados<br>
</li>
<li>apply() funciona com várias séries (várias colunas) ao mesmo tempo. No entanto, transform() só pode funcionar com uma série de cada vez.</li>
</ul>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de string</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>df5[<span class="st">'populacao'</span>].transform(<span class="st">'sqrt'</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lista de funções</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>df5[<span class="st">'area'</span>].transform([np.sqrt, np.exp])</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Dicionário</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>df5.transform({</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'populacao'</span>: np.sqrt,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'area'</span>: np.exp,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cidade</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Braga</td>
<td>439.686252</td>
<td>6.398435e+17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lisboa</td>
<td>737.783844</td>
<td>2.970829e+43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sintra</td>
<td>621.280130</td>
<td>2.168746e+10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cascais</td>
<td>462.859590</td>
<td>1.479089e+42</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Loures</td>
<td>448.719289</td>
<td>1.332524e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Almada</td>
<td>421.832905</td>
<td>2.421748e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vila Nova de Gaia</td>
<td>551.573205</td>
<td>2.823445e+24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Porto</td>
<td>481.491433</td>
<td>9.545343e+17</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply consegue produzir agregados</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>df5.<span class="bu">apply</span>(<span class="kw">lambda</span> x:x.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>populacao                                              2253236
area                                                     386.2
nuts3                                 11217017017017017011A11A
nuts3_dsg    CávadoÁrea Met. LisboaÁrea Met. LisboaÁrea Met...
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">## mas não funciona com o transform</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>df5.transform(<span class="kw">lambda</span> x:x.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> subtract_two(x):</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="st">'populacao'</span>] <span class="op">-</span> x[<span class="st">'area'</span>]</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># apply funciona com várias séries em simultâneo</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>df5.<span class="bu">apply</span>(subtract_two, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>cidade
Braga                193283.0
Lisboa               544224.9
Sintra               385965.2
Cascais              214141.9
Loures               201337.2
Almada               177928.3
Vila Nova de Gaia    304176.7
Porto                231792.6
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mas o transform não</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>df5.transform(subtract_two, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Especificar as Split Keys para os grupos</p>
<p>Podemos fazer grupos com uma lista, série ou index a especificar as keys pelas quais se faz o agrupamento. A key pode ser uma série ou lista com o comprimento da DataFrame.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>]</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>df5.groupby(L).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>757256</td>
<td>79.5</td>
<td>112170170</td>
<td>CávadoÁrea Met. LisboaÁrea Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>990398</td>
<td>238.6</td>
<td>17017011A</td>
<td>Área Met. LisboaÁrea Met. LisboaÁrea Met. Porto</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>201349</td>
<td>11.8</td>
<td>170</td>
<td>Área Met. Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>304233</td>
<td>56.3</td>
<td>11A</td>
<td>Área Met. Porto</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># forma mais verbosa equivalente ao que temos usado até agora</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># aqui explictamos que a key é df5['nuts3'] e não apenas 'nuts3'</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>df5.groupby(df5[<span class="st">'nuts3'</span>]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>193324</td>
<td>41.0</td>
<td>Cávado</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11A</td>
<td>536067</td>
<td>97.7</td>
<td>Área Met. PortoÁrea Met. Porto</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>1523845</td>
<td>247.5</td>
<td>Área Met. LisboaÁrea Met. LisboaÁrea Met. Lisb...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># com um dicionário</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>df2g <span class="op">=</span> df5.set_index(<span class="st">'nuts3'</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {<span class="st">'11A'</span>: <span class="st">'norte'</span>, <span class="st">'112'</span>: <span class="st">'norte'</span>, <span class="st">'170'</span>: <span class="st">'centro'</span>}</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>df2g</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>df2g.groupby(mapping).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">populacao</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">nuts3_dsg</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nuts3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">centro</td>
<td>1523845</td>
<td>247.5</td>
<td>Área Met. LisboaÁrea Met. LisboaÁrea Met. Lisb...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">norte</td>
<td>729391</td>
<td>138.7</td>
<td>CávadoÁrea Met. PortoÁrea Met. Porto</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pivot-tables" class="level4" data-number="5.1.4.4">
<h4 data-number="5.1.4.4" class="anchored" data-anchor-id="pivot-tables"><span class="header-section-number">5.1.4.4</span> Pivot Tables</h4>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns <span class="co"># importamos esta package para termos acesso a um dataset</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>titanic <span class="op">=</span> sns.load_dataset(<span class="st">'titanic'</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>titanic.head()</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>titanic.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">survived</th>
<th data-quarto-table-cell-role="th">pclass</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sibsp</th>
<th data-quarto-table-cell-role="th">parch</th>
<th data-quarto-table-cell-role="th">fare</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>891.000000</td>
<td>891.000000</td>
<td>714.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.383838</td>
<td>2.308642</td>
<td>29.699118</td>
<td>0.523008</td>
<td>0.381594</td>
<td>32.204208</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.486592</td>
<td>0.836071</td>
<td>14.526497</td>
<td>1.102743</td>
<td>0.806057</td>
<td>49.693429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.420000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>2.000000</td>
<td>20.125000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>7.910400</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.000000</td>
<td>3.000000</td>
<td>28.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>14.454200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.000000</td>
<td>3.000000</td>
<td>38.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>31.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000</td>
<td>3.000000</td>
<td>80.000000</td>
<td>8.000000</td>
<td>6.000000</td>
<td>512.329200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Preparar manualmente a Pivot Table</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>titanic.groupby(<span class="st">'sex'</span>)[[<span class="st">'survived'</span>]].mean()</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>titanic.groupby([<span class="st">'sex'</span>, <span class="st">'class'</span>], observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'survived'</span>].mean().unstack() <span class="co"># unstack para ter a pivot table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">class</th>
<th data-quarto-table-cell-role="th">First</th>
<th data-quarto-table-cell-role="th">Second</th>
<th data-quarto-table-cell-role="th">Third</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">female</td>
<td>0.968085</td>
<td>0.921053</td>
<td>0.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">male</td>
<td>0.368852</td>
<td>0.157407</td>
<td>0.135447</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>titanic.pivot_table(index<span class="op">=</span><span class="st">'sex'</span>, columns<span class="op">=</span><span class="st">'class'</span>,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                    values<span class="op">=</span><span class="st">'survived'</span>, aggfunc<span class="op">=</span><span class="st">'mean'</span>, observed<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">class</th>
<th data-quarto-table-cell-role="th">First</th>
<th data-quarto-table-cell-role="th">Second</th>
<th data-quarto-table-cell-role="th">Third</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">female</td>
<td>0.968085</td>
<td>0.921053</td>
<td>0.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">male</td>
<td>0.368852</td>
<td>0.157407</td>
<td>0.135447</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Syntax Pivot Table</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>titanic.pivot_table(<span class="st">'survived'</span>, index<span class="op">=</span><span class="st">'sex'</span>, columns<span class="op">=</span><span class="st">'class'</span>, aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>age_group <span class="op">=</span> pd.cut(titanic[<span class="st">'age'</span>], [<span class="dv">0</span>, <span class="dv">18</span>, <span class="dv">80</span>])</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>age_group</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># multilevel pivot table</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>titanic.pivot_table(<span class="st">'survived'</span>, index<span class="op">=</span>[<span class="st">'sex'</span>, age_group], </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span><span class="st">'class'</span>, aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">class</th>
<th data-quarto-table-cell-role="th">First</th>
<th data-quarto-table-cell-role="th">Second</th>
<th data-quarto-table-cell-role="th">Third</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">female</td>
<td data-quarto-table-cell-role="th">(0, 18]</td>
<td>0.909091</td>
<td>1.000000</td>
<td>0.511628</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">(18, 80]</td>
<td>0.972973</td>
<td>0.900000</td>
<td>0.423729</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">male</td>
<td data-quarto-table-cell-role="th">(0, 18]</td>
<td>0.800000</td>
<td>0.600000</td>
<td>0.215686</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">(18, 80]</td>
<td>0.375000</td>
<td>0.071429</td>
<td>0.133663</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Summary Statistics na DataFrame</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>titanic.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">survived</th>
<th data-quarto-table-cell-role="th">pclass</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sibsp</th>
<th data-quarto-table-cell-role="th">parch</th>
<th data-quarto-table-cell-role="th">fare</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>891.000000</td>
<td>891.000000</td>
<td>714.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.383838</td>
<td>2.308642</td>
<td>29.699118</td>
<td>0.523008</td>
<td>0.381594</td>
<td>32.204208</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.486592</td>
<td>0.836071</td>
<td>14.526497</td>
<td>1.102743</td>
<td>0.806057</td>
<td>49.693429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.420000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>2.000000</td>
<td>20.125000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>7.910400</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.000000</td>
<td>3.000000</td>
<td>28.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>14.454200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.000000</td>
<td>3.000000</td>
<td>38.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>31.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000</td>
<td>3.000000</td>
<td>80.000000</td>
<td>8.000000</td>
<td>6.000000</td>
<td>512.329200</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>todas estas funções estão disponíveis como fomos vendo nos exemplos anteriores</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>titanic.pivot_table(<span class="st">'fare'</span>, index<span class="op">=</span>[<span class="st">'sex'</span>], </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>                    columns<span class="op">=</span><span class="st">'class'</span>, aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>titanic.pivot_table(<span class="st">'survived'</span>, index<span class="op">=</span>[<span class="st">'class'</span>], aggfunc<span class="op">=</span><span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">survived</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">class</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">First</td>
<td>216</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Second</td>
<td>184</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Third</td>
<td>491</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="estatisticas-oficiais" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="estatisticas-oficiais"><span class="header-section-number">5.2</span> Estatisticas Oficiais</h2>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span><span class="st">"data</span><span class="ch">\\</span><span class="st">"</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"PT_2012_Hosp.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ler os dados:</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>datadir<span class="sc">}{</span>filename<span class="sc">}</span><span class="ss">"</span>, index_col<span class="op">=</span><span class="dv">0</span>, verbose <span class="op">=</span> <span class="va">False</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>df_hosp.describe()</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.reset_index() <span class="co"># passar o index para uma coluna; podia ser feito com inplace = True</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">DTCC_COD</th>
<th data-quarto-table-cell-role="th">CC_DSG</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C30001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>229</td>
<td>17</td>
<td>1504</td>
<td>Barreiro</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>...</td>
<td>493.0</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>206</td>
<td>17</td>
<td>1507</td>
<td>Montijo</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>46.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>65</td>
<td>16</td>
<td>502</td>
<td>Castelo Branco</td>
<td>894.0</td>
<td>111.0</td>
<td>89.0</td>
<td>0.0</td>
<td>8.0</td>
<td>...</td>
<td>337.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>106</td>
<td>17</td>
<td>1114</td>
<td>Vila Franca de Xira</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>...</td>
<td>264.0</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>209</td>
<td>11</td>
<td>1315</td>
<td>Valongo</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>88.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 64 columns</p>
</div>
</div>
</div>
<section id="pre-processamento" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="pre-processamento"><span class="header-section-number">5.2.1</span> Pre-processamento</h3>
<section id="exclusão-de-colunas" class="level4" data-number="5.2.1.1">
<h4 data-number="5.2.1.1" class="anchored" data-anchor-id="exclusão-de-colunas"><span class="header-section-number">5.2.1.1</span> Exclusão de colunas:</h4>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exclusão da coluna nordem</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span>[<span class="st">'NORDEM'</span>])</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">DTCC_COD</th>
<th data-quarto-table-cell-role="th">CC_DSG</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C30001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1504</td>
<td>Barreiro</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>...</td>
<td>493.0</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>1507</td>
<td>Montijo</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>46.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>502</td>
<td>Castelo Branco</td>
<td>894.0</td>
<td>111.0</td>
<td>89.0</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>...</td>
<td>337.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>1114</td>
<td>Vila Franca de Xira</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>...</td>
<td>264.0</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>11</td>
<td>1315</td>
<td>Valongo</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>88.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 63 columns</p>
</div>
</div>
</div>
</section>
<section id="variáveis-com-demasiadas-categorias" class="level4" data-number="5.2.1.2">
<h4 data-number="5.2.1.2" class="anchored" data-anchor-id="variáveis-com-demasiadas-categorias"><span class="header-section-number">5.2.1.2</span> Variáveis com demasiadas categorias:</h4>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df_hosp[<span class="st">'NUTS2'</span>].value_counts().sort_values()</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>df_hosp[<span class="st">'DTCC_COD'</span>].value_counts()</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>df_hosp[<span class="st">'DTCC_COD'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>) <span class="co"># resultados percentuais</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>DTCC_COD
1106    0.158416
603     0.099010
1312    0.069307
602     0.019802
1110    0.019802
          ...   
1503    0.009901
1419    0.009901
1401    0.009901
1418    0.009901
1408    0.009901
Name: proportion, Length: 63, dtype: float64</code></pre>
</div>
</div>
<p>Agregar todos os municipios com menos de dez por cento das ocorrências na amostra:</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># verifica contagens para a coluna DTCC_COD</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>df_hosp[<span class="st">'DTCC_COD_COUNT'</span>]<span class="op">=</span> df_hosp.DTCC_COD.<span class="bu">map</span>(df_hosp.DTCC_COD.value_counts(normalize<span class="op">=</span><span class="va">True</span>)) <span class="co"># Constroi a nova coluna</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Correr sem criar a coluna primeiro</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>df_hosp.loc[df_hosp[<span class="st">'DTCC_COD_COUNT'</span>] <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="st">'DTCC_COD_NEW'</span>] <span class="op">=</span> <span class="st">'outro'</span> <span class="co"># Constroi a nova coluna</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>df_hosp.loc[df_hosp[<span class="st">'DTCC_COD_COUNT'</span>] <span class="op">&gt;=</span> <span class="fl">0.1</span>, <span class="st">'DTCC_COD_NEW'</span>] <span class="op">=</span> df_hosp[<span class="st">'CC_DSG'</span>] <span class="co"># atualiza os valores em falta</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>df_hosp.loc[:,[<span class="st">'DTCC_COD_NEW'</span>,<span class="st">'DTCC_COD'</span>, <span class="st">'CC_DSG'</span>]] <span class="co"># todas as linhas e as colunas selecionadas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
<th data-quarto-table-cell-role="th">DTCC_COD</th>
<th data-quarto-table-cell-role="th">CC_DSG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>outro</td>
<td>1504</td>
<td>Barreiro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>outro</td>
<td>1507</td>
<td>Montijo</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>outro</td>
<td>502</td>
<td>Castelo Branco</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>outro</td>
<td>1114</td>
<td>Vila Franca de Xira</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>outro</td>
<td>1315</td>
<td>Valongo</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>outro</td>
<td>1110</td>
<td>Oeiras</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>Lisboa</td>
<td>1106</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>outro</td>
<td>1312</td>
<td>Porto</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>outro</td>
<td>1312</td>
<td>Porto</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>outro</td>
<td>1408</td>
<td>Constância</td>
</tr>
</tbody>
</table>

<p>101 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exclusão das colunas já tratadas</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span>[<span class="st">'DTCC_COD'</span>, <span class="st">'CC_DSG'</span>,<span class="st">'DTCC_COD_COUNT'</span>])</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>89.0</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>11</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>5 rows × 62 columns</p>
</div>
</div>
</div>
</section>
<section id="missing-data" class="level4" data-number="5.2.1.3">
<h4 data-number="5.2.1.3" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">5.2.1.3</span> Missing data</h4>
<p>sem o scikit</p>
<p>verificar onde temos dados em falta o método <code>isna()</code></p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check missing data</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>df_hosp.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>ANO              0
NUTS2            0
C10001          15
C20001          15
C21001          15
                ..
C31051          15
C31061          15
C31071          15
C32001          15
DTCC_COD_NEW     0
Length: 62, dtype: int64</code></pre>
</div>
</div>
<p>por haver linhas com todos os valores missing então há colunas que devem ser excluídos.</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>df_hosp[df_hosp.isna().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>2012</td>
<td>16</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">58</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59</td>
<td>2012</td>
<td>17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>2012</td>
<td>11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>2012</td>
<td>11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>2012</td>
<td>11</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>15 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dropna pode ser parametrizado para linhas ou colunas, e até thresholds</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>df_hosp1 <span class="op">=</span> df_hosp.dropna()</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>df_hosp1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>89.0</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>11</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>2012</td>
<td>17</td>
<td>96.0</td>
<td>13.0</td>
<td>10.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>9.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>20.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>2012</td>
<td>17</td>
<td>191.0</td>
<td>42.0</td>
<td>42.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>...</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>27.0</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>2012</td>
<td>11</td>
<td>66.0</td>
<td>21.0</td>
<td>16.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>8.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>2012</td>
<td>11</td>
<td>491.0</td>
<td>132.0</td>
<td>76.0</td>
<td>0.0</td>
<td>4.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>...</td>
<td>6.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>93.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>2012</td>
<td>16</td>
<td>59.0</td>
<td>6.0</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>16.0</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>86 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos fazer uma cópia para testes</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df_hosp1.copy()</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>89.0</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>11</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">96</td>
<td>2012</td>
<td>17</td>
<td>96.0</td>
<td>13.0</td>
<td>10.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>9.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>20.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>2012</td>
<td>17</td>
<td>191.0</td>
<td>42.0</td>
<td>42.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>...</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>27.0</td>
<td>Lisboa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>2012</td>
<td>11</td>
<td>66.0</td>
<td>21.0</td>
<td>16.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>8.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99</td>
<td>2012</td>
<td>11</td>
<td>491.0</td>
<td>132.0</td>
<td>76.0</td>
<td>0.0</td>
<td>4.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>...</td>
<td>6.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>93.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100</td>
<td>2012</td>
<td>16</td>
<td>59.0</td>
<td>6.0</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>16.0</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>86 rows × 62 columns</p>
</div>
</div>
</div>
<p>Vamos introduzir um NaN num registo para experimentarmos outras formas de tratamento</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">0</span>:<span class="dv">3</span>, :]</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">2</span>,<span class="st">'C21001'</span>] <span class="op">=</span> np.nan</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">0</span>:<span class="dv">3</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>NaN</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>4 rows × 62 columns</p>
</div>
</div>
</div>
<p>vamos inserir o valor médio da C21001 (Médicos - Especialistas - Total) para a nuts 16, mas de uma forma genérica para qualquer que fosse a coluna numérica:</p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># passo 1 seleccionar a/as colunas onde há valores missing</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>cols_missing <span class="op">=</span> df1.isna().<span class="bu">sum</span>().index[df1.isna().<span class="bu">sum</span>().values <span class="op">&gt;</span><span class="dv">0</span>].tolist()</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols_missing)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># passo 2 seleccionar o conjunto de colunas da dataframe que são numéricas</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>cols_numerical <span class="op">=</span> df1.select_dtypes(include<span class="op">=</span>[<span class="st">'number'</span>]).columns.tolist()</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols_numerical)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># passo 3 imputar a mediana na for missing data</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>cols_numerical_missing <span class="op">=</span> [ col <span class="cf">for</span> col <span class="kw">in</span> cols_missing <span class="cf">if</span> (col <span class="kw">in</span> cols_numerical)] <span class="co"># loop for condicional</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>df1[cols_numerical_missing] <span class="op">=</span> df1[cols_numerical_missing].fillna(df1.groupby(<span class="st">'NUTS2'</span>)[cols_numerical_missing].transform(<span class="st">'mean'</span>))</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">0</span>:<span class="dv">3</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['C21001']
['ANO', 'NUTS2', 'C10001', 'C20001', 'C21001', 'C21011', 'C21021', 'C21031', 'C21041', 'C21061', 'C21071', 'C21081', 'C21091', 'C21101', 'C21111', 'C21121', 'C21131', 'C21141', 'C21151', 'C21161', 'C21171', 'C21181', 'C21191', 'C21201', 'C21211', 'C21221', 'C21231', 'C21241', 'C21251', 'C21261', 'C21271', 'C21281', 'C21291', 'C21301', 'C21311', 'C21321', 'C21331', 'C21341', 'C21351', 'C21361', 'C21371', 'C21381', 'C21391', 'C21401', 'C21411', 'C21421', 'C21431', 'C21441', 'C22001', 'C23001', 'C24001', 'C30001', 'C31001', 'C31011', 'C31021', 'C31031', 'C31041', 'C31051', 'C31061', 'C31071', 'C32001']</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="84">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">DTCC_COD_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>outro</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>outro</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>outro</td>
</tr>
</tbody>
</table>

<p>4 rows × 62 columns</p>
</div>
</div>
</div>
<p>quando não aplicamos o transform temos resultados diferentes:</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtemos uma dataframe com 7 linhas e index na nuts2</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>df1.groupby(<span class="st">'NUTS2'</span>)[cols_numerical_missing].mean()</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># obtemos o mesmo nº de linhas que a dataframe tinha com a média calculada pelo group by</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sem index</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>df1.groupby(<span class="st">'NUTS2'</span>)[cols_numerical_missing].transform(<span class="st">'mean'</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co"># verificação das médias</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>df1.groupby(<span class="st">'NUTS2'</span>)[<span class="st">'C21001'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>NUTS2
11     57.933333
15     61.500000
16     38.250000
17    152.300000
18     68.500000
20     30.000000
30     29.000000
Name: C21001, dtype: float64</code></pre>
</div>
</div>
<p>usando o <code>scikit</code></p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">2</span>,<span class="st">'C21001'</span>] <span class="op">=</span> np.nan</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>df1.loc[<span class="dv">0</span>:<span class="dv">3</span>, :]</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># o simple imputer não pode ser usado em colunas categóricas </span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># com a estratégia de média, só em colunas numéricas</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df1.drop(columns <span class="op">=</span> [<span class="st">'DTCC_COD_NEW'</span>])</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> SimpleImputer(missing_values<span class="op">=</span>np.nan, strategy<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>imputer.fit(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>SimpleImputer()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div></div></div>
</div>
</div>
<p>e agora atua sobre a dataframe:</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.DataFrame(imputer.transform(df1))</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">51</th>
<th data-quarto-table-cell-role="th">52</th>
<th data-quarto-table-cell-role="th">53</th>
<th data-quarto-table-cell-role="th">54</th>
<th data-quarto-table-cell-role="th">55</th>
<th data-quarto-table-cell-role="th">56</th>
<th data-quarto-table-cell-role="th">57</th>
<th data-quarto-table-cell-role="th">58</th>
<th data-quarto-table-cell-role="th">59</th>
<th data-quarto-table-cell-role="th">60</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.0</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>493.0</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>46.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>16.0</td>
<td>894.0</td>
<td>111.0</td>
<td>74.4</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>337.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>17.0</td>
<td>801.0</td>
<td>166.0</td>
<td>108.0</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>264.0</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>11.0</td>
<td>221.0</td>
<td>13.0</td>
<td>13.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>88.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">81</td>
<td>2012.0</td>
<td>17.0</td>
<td>96.0</td>
<td>13.0</td>
<td>10.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>29.0</td>
<td>9.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>1.0</td>
<td>20.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">82</td>
<td>2012.0</td>
<td>17.0</td>
<td>191.0</td>
<td>42.0</td>
<td>42.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>...</td>
<td>32.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>27.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">83</td>
<td>2012.0</td>
<td>11.0</td>
<td>66.0</td>
<td>21.0</td>
<td>16.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>10.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>8.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">84</td>
<td>2012.0</td>
<td>11.0</td>
<td>491.0</td>
<td>132.0</td>
<td>76.0</td>
<td>0.0</td>
<td>4.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>...</td>
<td>99.0</td>
<td>6.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>93.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">85</td>
<td>2012.0</td>
<td>16.0</td>
<td>59.0</td>
<td>6.0</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>17.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>16.0</td>
</tr>
</tbody>
</table>

<p>86 rows × 61 columns</p>
</div>
</div>
</div>
<p>o método <code>SimpleImputer</code> do <code>scikit.impute</code> não suporta o <code>groupby</code> directamente mas é muito útil e suporta categorias quando a estratégia selecionada é ‘<code>most_frequent</code>’ ou ‘<code>constant</code>’ além disso pode ser usado indirectamente o <code>groupby</code> recorrendo a uma função lambda aplicada nas colunas dentro da função <code>transform</code></p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>x.iloc[:<span class="dv">4</span>,:<span class="dv">6</span>]</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>df1.iloc[:<span class="dv">4</span>,:<span class="dv">6</span>]</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'C21001'</span>] <span class="op">=</span> df1.groupby(<span class="st">'NUTS2'</span>)[<span class="st">'C21001'</span>].transform(</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> col: imputer.fit_transform(col.to_frame()).flatten(),)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>df1.iloc[:<span class="dv">4</span>,:<span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Imputação de Variáveis Categóricas</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleciona todas as colunas categóricas e atribui-lhes </span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># um novo nível criado 'missing'</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>cols_categorical <span class="op">=</span> df_hosp.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns.tolist()</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>df_hosp[cols_categorical] <span class="op">=</span> df_hosp[cols_categorical].fillna(<span class="st">'missing'</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols_categorical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['DTCC_COD_NEW']</code></pre>
</div>
</div>
<p>exemplo em que usamos vários imputadores em simultâneo, seria possível usando o ColumnTransformer do módulo <code>sklearn.compose</code> e especificando as colunas a fectar é apresentado abaixo:</p>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [[np.nan,<span class="dv">2</span>,<span class="st">'Jose'</span>],[<span class="dv">4</span>,np.nan,<span class="st">'Maria'</span>],[<span class="dv">7</span>,<span class="dv">8</span>,<span class="st">'Joao'</span>],[<span class="dv">10</span>,<span class="dv">5</span>,np.nan]]</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>col_trans <span class="op">=</span> ColumnTransformer(</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>[(<span class="st">'imp0'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'constant'</span>, fill_value<span class="op">=</span><span class="dv">1</span>), [<span class="dv">0</span>]),</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a> (<span class="st">'imp1'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="dv">1</span>]),</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a> (<span class="st">'imp2'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'constant'</span>, fill_value<span class="op">=</span><span class="st">'desconhecido'</span>), [<span class="dv">2</span>])],</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>remainder<span class="op">=</span><span class="st">'passthrough'</span>)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>col_trans.fit_transform(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>array([[1, 2.0, 'Jose'],
       [4, 5.0, 'Maria'],
       [7, 8.0, 'Joao'],
       [10, 5.0, 'desconhecido']], dtype=object)</code></pre>
</div>
</div>
<p>Imputação com o vizinho mais próximo</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> [[<span class="dv">1</span>, <span class="dv">2</span>, np.nan], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>], [np.nan, <span class="dv">6</span>, <span class="dv">5</span>], [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>]]</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> KNNImputer(n_neighbors<span class="op">=</span><span class="dv">2</span>, weights<span class="op">=</span><span class="st">"uniform"</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>imputer.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>array([[1. , 2. , 4. ],
       [3. , 4. , 3. ],
       [5.5, 6. , 5. ],
       [8. , 8. , 7. ]])</code></pre>
</div>
</div>
</section>
<section id="variáveis-categóricas" class="level4" data-number="5.2.1.4">
<h4 data-number="5.2.1.4" class="anchored" data-anchor-id="variáveis-categóricas"><span class="header-section-number">5.2.1.4</span> Variáveis Categóricas</h4>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Typecast da coluna para categoria em usando o pandas</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'NUTS2'</span>] <span class="op">=</span> pd.Categorical(df1.NUTS2)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>df1.dtypes</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Typecast da coluna para categoria em python</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>df_hosp11 <span class="op">=</span> df_hosp1.copy()</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>df_hosp11[<span class="st">'NUTS2'</span>]<span class="op">=</span> df_hosp1.NUTS2.astype(<span class="st">'category'</span>)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>df_hosp11.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>ANO                int64
NUTS2           category
C10001           float64
C20001           float64
C21001           float64
                  ...   
C31051           float64
C31061           float64
C31071           float64
C32001           float64
DTCC_COD_NEW      object
Length: 62, dtype: object</code></pre>
</div>
</div>
<p>Criação de Variáveis Categóricas</p>
<p>criar colunas à custa de outras colunas directamente usando o método <code>map</code>:</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df_hosp2 <span class="op">=</span> df1.copy()</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>df_hosp2</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(value): <span class="co"># função para criar uma variável dummy</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"no"</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"yes"</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>df_hosp2[<span class="st">'t_cirurgia'</span>] <span class="op">=</span> df_hosp2[<span class="st">'C21071'</span>].<span class="bu">map</span>(label)</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>df_hosp2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>17</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>17</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>16</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>17</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>11</td>
<td>221.0</td>
<td>13.0</td>
<td>13.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>yes</td>
</tr>
</tbody>
</table>

<p>5 rows × 62 columns</p>
</div>
</div>
</div>
<p>Variáveis Dummy</p>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos y como o nosso target</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_hosp2.drop(columns<span class="op">=</span>[<span class="st">'t_cirurgia'</span>])</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_hosp2[<span class="st">'t_cirurgia'</span>].values</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Transforma as variáveis categoricas em dummies com drop da baseline</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>df_x <span class="op">=</span> pd.get_dummies(X, drop_first <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>df_x.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21071</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">NUTS2_15</th>
<th data-quarto-table-cell-role="th">NUTS2_16</th>
<th data-quarto-table-cell-role="th">NUTS2_17</th>
<th data-quarto-table-cell-role="th">NUTS2_18</th>
<th data-quarto-table-cell-role="th">NUTS2_20</th>
<th data-quarto-table-cell-role="th">NUTS2_30</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>19.0</td>
<td>...</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>10.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>12.0</td>
<td>...</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>221.0</td>
<td>13.0</td>
<td>13.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>...</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>5 rows × 66 columns</p>
</div>
</div>
</div>
<p>Variáveis Dummy com Scikit</p>
<p>Scikit tem vários encoders os mais comuns são o <code>OrdinalEncoder</code> e o <code>HotEncoder</code>.</p>
<ul>
<li><code>OrdinalEncoder</code> é usado para transformar variáveis categóricas em numéricas.</li>
<li><code>OneHotEncoder</code> é usado para transformar variáveis categóricas em variáveis dummy.</li>
</ul>
<p>(criar encoder, fazer o fit e efectuar a transformação)</p>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos X_sk como a coluna para criar dummies nos exemplos scikit</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co"># atenção df_hosp2[['NUTS2']] é uma dataframe, df_hosp2['NUTS2'] é uma serie</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>X_sk <span class="op">=</span> df_hosp2[[<span class="st">'NUTS2'</span>]]</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(df_hosp2[[<span class="st">'NUTS2'</span>]]))</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> encoder.fit(X_sk)</span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> pd.DataFrame(encoder.transform(X_sk).toarray()) <span class="co"># transforma a matriz em dataframe</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>X_encoded.head()</span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>X_encoded <span class="op">=</span> X_encoded.rename(columns <span class="op">=</span> {<span class="dv">0</span> : <span class="st">"Nut0"</span>, <span class="dv">1</span> : <span class="st">"Nut1"</span>, <span class="dv">2</span> : <span class="st">"Nut2"</span>, <span class="dv">3</span> : <span class="st">"Nut3"</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>                                       , <span class="dv">4</span> : <span class="st">"Nut4"</span>, <span class="dv">5</span> : <span class="st">"Nut5"</span>, <span class="dv">6</span> : <span class="st">"Nut6"</span>}) <span class="co"># renomeia as colunas</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>X_encoded</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="co"># merge com a dataframe dos hospitais</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>df_hosp2 <span class="op">=</span> df_hosp2.join(X_encoded)</span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>df_hosp2 <span class="op">=</span> df_hosp2.drop(columns <span class="op">=</span> <span class="st">'NUTS2'</span>) <span class="co"># drop da coluna original</span></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>df_hosp2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;


</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21071</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
<th data-quarto-table-cell-role="th">Nut0</th>
<th data-quarto-table-cell-role="th">Nut1</th>
<th data-quarto-table-cell-role="th">Nut2</th>
<th data-quarto-table-cell-role="th">Nut3</th>
<th data-quarto-table-cell-role="th">Nut4</th>
<th data-quarto-table-cell-role="th">Nut5</th>
<th data-quarto-table-cell-role="th">Nut6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>19.0</td>
<td>...</td>
<td>0.0</td>
<td>454.0</td>
<td>yes</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>46.0</td>
<td>no</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>10.0</td>
<td>...</td>
<td>0.0</td>
<td>337.0</td>
<td>yes</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>12.0</td>
<td>...</td>
<td>0.0</td>
<td>228.0</td>
<td>yes</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>221.0</td>
<td>13.0</td>
<td>13.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>...</td>
<td>0.0</td>
<td>80.0</td>
<td>yes</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 68 columns</p>
</div>
</div>
</div>
</section>
<section id="variáveis-correlacionadas" class="level4" data-number="5.2.1.5">
<h4 data-number="5.2.1.5" class="anchored" data-anchor-id="variáveis-correlacionadas"><span class="header-section-number">5.2.1.5</span> Variáveis Correlacionadas</h4>
<p>em modelos de regressão podemos ter problemas com variáveis correlacionadas (multicolinearidade)</p>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criação de matriz de correlação e selecão do triângulo superior</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="op">=</span> df_x.corr().<span class="bu">abs</span>()</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>cor_matrix</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>upper_tri <span class="op">=</span> cor_matrix.where(np.triu(np.ones(cor_matrix.shape),k<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">bool</span>))</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(upper_tri)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
          ANO  C10001    C20001    C21001    C21011    C21021    C21031  \
ANO       NaN     NaN       NaN       NaN       NaN       NaN       NaN   
C10001    NaN     NaN  0.982999  0.983593  0.783939  0.926770  0.662279   
C20001    NaN     NaN       NaN  0.996023  0.758603  0.937420  0.689197   
C21001    NaN     NaN       NaN       NaN  0.780568  0.944305  0.689538   
C21011    NaN     NaN       NaN       NaN       NaN  0.708871  0.501019   
...       ...     ...       ...       ...       ...       ...       ...   
NUTS2_16  NaN     NaN       NaN       NaN       NaN       NaN       NaN   
NUTS2_17  NaN     NaN       NaN       NaN       NaN       NaN       NaN   
NUTS2_18  NaN     NaN       NaN       NaN       NaN       NaN       NaN   
NUTS2_20  NaN     NaN       NaN       NaN       NaN       NaN       NaN   
NUTS2_30  NaN     NaN       NaN       NaN       NaN       NaN       NaN   

            C21041    C21061    C21071  ...    C31051    C31061    C31071  \
ANO            NaN       NaN       NaN  ...       NaN       NaN       NaN   
C10001    0.856563  0.550499  0.900382  ...  0.285700  0.405187  0.334934   
C20001    0.864047  0.560911  0.880763  ...  0.259565  0.412341  0.336556   
C21001    0.860977  0.563814  0.891950  ...  0.250113  0.405222  0.341762   
C21011    0.638383  0.576456  0.691786  ...  0.256874  0.146949  0.135031   
...            ...       ...       ...  ...       ...       ...       ...   
NUTS2_16       NaN       NaN       NaN  ...       NaN       NaN       NaN   
NUTS2_17       NaN       NaN       NaN  ...       NaN       NaN       NaN   
NUTS2_18       NaN       NaN       NaN  ...       NaN       NaN       NaN   
NUTS2_20       NaN       NaN       NaN  ...       NaN       NaN       NaN   
NUTS2_30       NaN       NaN       NaN  ...       NaN       NaN       NaN   

            C32001  NUTS2_15  NUTS2_16  NUTS2_17  NUTS2_18  NUTS2_20  NUTS2_30  
ANO            NaN       NaN       NaN       NaN       NaN       NaN       NaN  
C10001    0.993045  0.027644  0.205653  0.380013  0.035742  0.020845  0.057632  
C20001    0.966742  0.022840  0.205238  0.370057  0.001802  0.042949  0.064700  
C21001    0.968224  0.017892  0.212531  0.400595  0.013943  0.044323  0.064488  
C21011    0.757519  0.022719  0.112272  0.370731  0.002489  0.041404  0.058901  
...            ...       ...       ...       ...       ...       ...       ...  
NUTS2_16       NaN       NaN       NaN  0.352410  0.175322  0.069438  0.098783  
NUTS2_17       NaN       NaN       NaN       NaN  0.150756  0.059708  0.084941  
NUTS2_18       NaN       NaN       NaN       NaN       NaN  0.029704  0.042258  
NUTS2_20       NaN       NaN       NaN       NaN       NaN       NaN  0.016737  
NUTS2_30       NaN       NaN       NaN       NaN       NaN       NaN       NaN  

[66 rows x 66 columns]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># o heatmap é uma boa forma de visualizar as matrizes de correlações</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cor_matrix)</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-101-output-1.png" width="1466" height="1580"></p>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seleciona para remover as colunas altamente correlacionadas</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>to_drop <span class="op">=</span> [column <span class="cf">for</span> column <span class="kw">in</span> upper_tri.columns <span class="cf">if</span> <span class="bu">any</span>(upper_tri[column] <span class="op">&gt;</span> <span class="fl">0.9</span>)]</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(to_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['C20001', 'C21001', 'C21021', 'C21071', 'C21251', 'C21421', 'C21431', 'C23001', 'C24001', 'C30001', 'C32001']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df_hosp3 <span class="op">=</span> df_x.drop(columns<span class="op">=</span>to_drop, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>df_hosp3.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21081</th>
<th data-quarto-table-cell-role="th">C21091</th>
<th data-quarto-table-cell-role="th">C21101</th>
<th data-quarto-table-cell-role="th">C21111</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">NUTS2_15</th>
<th data-quarto-table-cell-role="th">NUTS2_16</th>
<th data-quarto-table-cell-role="th">NUTS2_17</th>
<th data-quarto-table-cell-role="th">NUTS2_18</th>
<th data-quarto-table-cell-role="th">NUTS2_20</th>
<th data-quarto-table-cell-role="th">NUTS2_30</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>1458.0</td>
<td>2.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>...</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012</td>
<td>894.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012</td>
<td>801.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>...</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012</td>
<td>221.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>5 rows × 55 columns</p>
</div>
</div>
</div>
</section>
<section id="class-imbalance" class="level4" data-number="5.2.1.6">
<h4 data-number="5.2.1.6" class="anchored" data-anchor-id="class-imbalance"><span class="header-section-number">5.2.1.6</span> Class Imbalance</h4>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co"># exemplo de declaração do regressor balanceando as classes</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>Lr <span class="op">=</span> LogisticRegression(class_weight<span class="op">=</span><span class="st">'balanced'</span>) <span class="co"># declarar uma regressão logística com classes balanceadas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalização-e-standardização" class="level4" data-number="5.2.1.7">
<h4 data-number="5.2.1.7" class="anchored" data-anchor-id="normalização-e-standardização"><span class="header-section-number">5.2.1.7</span> Normalização e Standardização</h4>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>shape <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>shape</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.random <span class="im">as</span> rd</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co"># *shape faz unpack do tuplo shape</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>rd.rand(<span class="op">*</span>shape) <span class="co"># gerador de samples de uma distribuição uniforme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>array([[0.42349003, 0.40232183],
       [0.28401884, 0.02372109],
       [0.80368144, 0.02655111],
       [0.79375441, 0.38028173]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random.RandomState.lognormal(mean=0.0, sigma=1.0, size=None) </span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gerador de samples de uma distribuição log-normal</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>rd.rand(<span class="op">*</span>shape) <span class="op">*</span> rd.lognormal(<span class="dv">0</span>, <span class="dv">1</span>, shape) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>array([[0.3344712 , 0.12974323],
       [0.3518378 , 0.03020305],
       [0.39042721, 0.02254668],
       [1.13437663, 0.01888698]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.random <span class="im">as</span> rd</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> Normalizer</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings <span class="co"># para suprimir warnings</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, <span class="st">"is_categorical_dtype"</span>)</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, <span class="st">"use_inf_as_na"</span>)</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>shape <span class="op">=</span> (<span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co"># *shape faz unpack do tuplo shape</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(rd.rand(<span class="op">*</span>shape) <span class="op">*</span> rd.lognormal(<span class="dv">1</span>, <span class="fl">0.4</span>, shape)</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>                  , columns<span class="op">=</span>[<span class="st">"weight"</span>, <span class="st">"age"</span>]) <span class="co"># gerar um dataframe com 100 linhas e 2 colunas</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>ndf <span class="op">=</span> pd.DataFrame(Normalizer(norm<span class="op">=</span><span class="st">"l2"</span>).fit_transform(df),</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>                   columns<span class="op">=</span>[<span class="st">"norm_weight"</span>, <span class="st">"norm_age"</span>]) <span class="co"># normalizar os dados</span></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimate (KDE) plot é um método para </span></span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizar a distribuição de observações num dataset</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>pd.concat([df, ndf], axis<span class="op">=</span><span class="dv">1</span>), fill<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>            common_norm<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">"crest"</span>,alpha<span class="op">=</span><span class="fl">.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>,)</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-107-output-1.png" width="589" height="411"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.255544</td>
<td>1.154349</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.926251</td>
<td>0.717597</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.754130</td>
<td>0.723132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.178142</td>
<td>2.662097</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.048820</td>
<td>0.473546</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.009291</td>
<td>1.538451</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>2.267227</td>
<td>0.106361</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>1.691314</td>
<td>0.029914</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>1.297201</td>
<td>1.236603</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>1.794532</td>
<td>0.670913</td>
</tr>
</tbody>
</table>

<p>100 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> [df]:</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>    sns.pairplot(d.reset_index(), hue<span class="op">=</span><span class="st">"index"</span>, diag_kind<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-108-output-1.png" width="544" height="474"></p>
</div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repete o exemplo com shape(50,2) faz standardization</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.random <span class="im">as</span> rd</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>shape <span class="op">=</span> (<span class="dv">50</span>, <span class="dv">2</span>)</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co"># *shape faz unpack do tuplo shape</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(rd.rand(<span class="op">*</span>shape) <span class="op">*</span> rd.normal(<span class="dv">10</span>, <span class="dv">6</span>, shape),</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>                  columns<span class="op">=</span>[<span class="st">"weight"</span>, <span class="st">"age"</span>])</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>ndf <span class="op">=</span> pd.DataFrame(StandardScaler().fit_transform(df),</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>                   columns<span class="op">=</span>[<span class="st">"norm_weight"</span>, <span class="st">"norm_age"</span>])</span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimate (KDE) plot é um método para </span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizar a distribuição de observações num dataset</span></span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>pd.concat([df, ndf], axis<span class="op">=</span><span class="dv">1</span>), </span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">True</span>, common_norm<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">"crest"</span>,</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">.5</span>, linewidth<span class="op">=</span><span class="dv">1</span>,)</span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-109-output-1.png" width="598" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> [df]:</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>    sns.pairplot(d.reset_index(), hue<span class="op">=</span><span class="st">"index"</span>, palette<span class="op">=</span><span class="st">"crest"</span>, diag_kind<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-110-output-1.png" width="544" height="474"></p>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold <span class="co"># Feature selector</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline <span class="co"># For setting up pipeline</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Define a pre-processing pipeline</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>(<span class="st">'selector'</span>, VarianceThreshold()),</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>(<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>(<span class="st">'KNN'</span>, KNeighborsClassifier())])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Simple pipeline execution with default parameters</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>pipeline.fit(X, y)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Training set score: '</span> <span class="op">+</span> <span class="bu">str</span>(pipeline.score(X,y)))</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>pipeline.predict(X)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>pipeline.predict_proba(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="gravar-os-dados" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="gravar-os-dados"><span class="header-section-number">5.2.2</span> Gravar os dados</h3>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>df_prep <span class="op">=</span> pd.concat([X, pd.DataFrame(y, columns<span class="op">=</span>[<span class="st">"t_cirurgia"</span>])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>df_prep.head()</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Exportação da dataframe</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>fileout <span class="op">=</span> <span class="st">'df_prep.csv'</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>df_prep.to_csv(<span class="ss">f"</span><span class="sc">{</span>datadir<span class="sc">}{</span>fileout<span class="sc">}</span><span class="ss">"</span>,  index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="introdução-a-machine-learning" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="introdução-a-machine-learning"><span class="header-section-number">5.3</span> Introdução a Machine Learning</h2>
<section id="regressão" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="regressão"><span class="header-section-number">5.3.1</span> Regressão</h3>
<p><strong>QUESTÃO</strong>:<br>
Com este conjunto de dados que inclui o número de médicos e enfermeiros em várias especialidades será que consigo estimar o nº de total de Enfermeiros - Especialistas - Em Saúde Infantil e Pediátrica em cada hospital?</p>
<ul>
<li>Coluna <strong>C31011</strong></li>
</ul>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span><span class="st">"data</span><span class="ch">\\</span><span class="st">"</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"df_prep.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>datadir<span class="sc">}{</span>filename<span class="sc">}</span><span class="ss">"</span>, index_col<span class="op">=</span><span class="dv">0</span>, verbose <span class="op">=</span> <span class="va">False</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>df_hosp.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="109">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C30001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>...</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>118.081395</td>
<td>14.976744</td>
<td>642.744186</td>
<td>113.872093</td>
<td>73.979651</td>
<td>0.813953</td>
<td>6.941860</td>
<td>0.360465</td>
<td>2.953488</td>
<td>0.302326</td>
<td>...</td>
<td>212.290698</td>
<td>22.941860</td>
<td>3.127907</td>
<td>6.220930</td>
<td>4.476744</td>
<td>3.465116</td>
<td>0.965116</td>
<td>3.465116</td>
<td>1.220930</td>
<td>189.348837</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>68.264230</td>
<td>3.620129</td>
<td>809.928453</td>
<td>172.413511</td>
<td>108.256016</td>
<td>2.144825</td>
<td>10.384779</td>
<td>1.146994</td>
<td>5.346592</td>
<td>1.701693</td>
<td>...</td>
<td>255.792649</td>
<td>26.911775</td>
<td>4.752204</td>
<td>10.678622</td>
<td>5.740930</td>
<td>8.559409</td>
<td>1.482825</td>
<td>4.421066</td>
<td>2.783993</td>
<td>240.396475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.000000</td>
<td>11.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>57.500000</td>
<td>11.000000</td>
<td>120.250000</td>
<td>7.750000</td>
<td>6.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>34.250000</td>
<td>3.250000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>30.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>119.000000</td>
<td>16.000000</td>
<td>338.500000</td>
<td>42.500000</td>
<td>33.000000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>102.500000</td>
<td>10.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>0.000000</td>
<td>85.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>175.750000</td>
<td>17.000000</td>
<td>872.500000</td>
<td>162.500000</td>
<td>115.500000</td>
<td>0.000000</td>
<td>10.750000</td>
<td>0.000000</td>
<td>3.750000</td>
<td>0.000000</td>
<td>...</td>
<td>321.250000</td>
<td>35.750000</td>
<td>4.000000</td>
<td>11.000000</td>
<td>6.000000</td>
<td>3.000000</td>
<td>1.000000</td>
<td>5.000000</td>
<td>1.000000</td>
<td>282.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>229.000000</td>
<td>30.000000</td>
<td>5325.000000</td>
<td>1161.000000</td>
<td>719.000000</td>
<td>13.000000</td>
<td>51.000000</td>
<td>6.000000</td>
<td>31.000000</td>
<td>13.000000</td>
<td>...</td>
<td>1515.000000</td>
<td>103.000000</td>
<td>21.000000</td>
<td>50.000000</td>
<td>28.000000</td>
<td>72.000000</td>
<td>6.000000</td>
<td>19.000000</td>
<td>15.000000</td>
<td>1515.000000</td>
</tr>
</tbody>
</table>

<p>8 rows × 61 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.reset_index() <span class="co"># passar o index para uma coluna; podia ser feito com inplace = True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos y como o nosso target</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span>[<span class="st">'t_cirurgia'</span>])</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_hosp[<span class="st">'t_cirurgia'</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criação de matriz de correlação e selecão do triângulo superior</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="op">=</span> X.corr().<span class="bu">abs</span>()</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>upper_tri <span class="op">=</span> cor_matrix.where(np.triu(np.ones(cor_matrix.shape),k<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">bool</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seleciona para remover as colunas altamente correlacionadas</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>to_drop <span class="op">=</span> [column <span class="cf">for</span> column <span class="kw">in</span> upper_tri.columns <span class="cf">if</span> <span class="bu">any</span>(upper_tri[column] <span class="op">&gt;</span> <span class="fl">0.9</span>)]</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(to_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['C20001', 'C21001', 'C21021', 'C21071', 'C21251', 'C21421', 'C21431', 'C23001', 'C24001', 'C30001', 'C32001']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span>to_drop, axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># drop das colunas altamente correlacionadas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21081</th>
<th data-quarto-table-cell-role="th">C21091</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C22001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>2.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>4.0</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>7.0</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
</tbody>
</table>

<p>5 rows × 52 columns</p>
</div>
</div>
</div>
<p>primeiro modelo de regressão linear com uma variavél explicativa:</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> smf.ols(<span class="st">'C31011 ~ C31001'</span>,data <span class="op">=</span> df_hosp).fit()</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 C31011   R-squared:                       0.679
Model:                            OLS   Adj. R-squared:                  0.675
Method:                 Least Squares   F-statistic:                     177.9
Date:                Wed, 24 Apr 2024   Prob (F-statistic):           1.89e-22
Time:                        14:44:14   Log-Likelihood:                -206.66
No. Observations:                  86   AIC:                             417.3
Df Residuals:                      84   BIC:                             422.2
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.2111      0.385     -0.549      0.585      -0.976       0.554
C31001         0.1455      0.011     13.339      0.000       0.124       0.167
==============================================================================
Omnibus:                       27.749   Durbin-Watson:                   2.131
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              128.206
Skew:                          -0.795   Prob(JB):                     1.45e-28
Kurtosis:                       8.766   Cond. No.                         46.4
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Este é o R entre as 2 variáveis</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> cor_matrix.loc[<span class="st">'C31001'</span>,<span class="st">'C31011'</span>]</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>0.8242029193194886</code></pre>
</div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># E este é o r quadrado</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r<span class="op">**</span><span class="dv">2</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>r2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>0.6793104522147675</code></pre>
</div>
</div>
<p>modelos com duas variáveis explicativas:</p>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> smf.ols(<span class="st">'C31011 ~ C31001 + C21011'</span>,data <span class="op">=</span> df_hosp).fit()</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 C31011   R-squared:                       0.681
Model:                            OLS   Adj. R-squared:                  0.673
Method:                 Least Squares   F-statistic:                     88.60
Date:                Wed, 24 Apr 2024   Prob (F-statistic):           2.55e-21
Time:                        14:44:14   Log-Likelihood:                -206.43
No. Observations:                  86   AIC:                             418.9
Df Residuals:                      83   BIC:                             426.2
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.2542      0.391     -0.650      0.518      -1.032       0.524
C31001         0.1441      0.011     12.916      0.000       0.122       0.166
C21011         0.0935      0.140      0.668      0.506      -0.185       0.372
==============================================================================
Omnibus:                       25.855   Durbin-Watson:                   2.130
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              118.604
Skew:                          -0.715   Prob(JB):                     1.76e-26
Kurtosis:                       8.573   Cond. No.                         47.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import statsmodels.formula.api as smf</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> smf.ols(<span class="st">'C31011 ~ C31001 + C21361'</span>,data <span class="op">=</span> df_hosp).fit()</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 C31011   R-squared:                       0.697
Model:                            OLS   Adj. R-squared:                  0.689
Method:                 Least Squares   F-statistic:                     95.36
Date:                Wed, 24 Apr 2024   Prob (F-statistic):           3.12e-22
Time:                        14:44:14   Log-Likelihood:                -204.26
No. Observations:                  86   AIC:                             414.5
Df Residuals:                      83   BIC:                             421.9
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.2519      0.377     -0.669      0.505      -1.001       0.497
C31001         0.1263      0.014      9.138      0.000       0.099       0.154
C21361         0.0760      0.035      2.186      0.032       0.007       0.145
==============================================================================
Omnibus:                       23.605   Durbin-Watson:                   2.008
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               93.192
Skew:                          -0.684   Prob(JB):                     5.80e-21
Kurtosis:                       7.913   Cond. No.                         48.2
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p>modelo com todas as variáveis explicativas:</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reorganiza as colunas para colocar a coluna target no fim</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>last_cols <span class="op">=</span> [<span class="st">'C31011'</span>]</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>first_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_hosp.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> last_cols]</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df_hosp[first_cols<span class="op">+</span>last_cols]</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21081</th>
<th data-quarto-table-cell-role="th">C21091</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C22001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
<th data-quarto-table-cell-role="th">C31011</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>2.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>4.0</td>
<td>39.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>yes</td>
<td>8.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>no</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>yes</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>7.0</td>
<td>36.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>yes</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>yes</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 52 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>string_cols <span class="op">=</span> <span class="st">' + '</span>.join(df.columns[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> smf.ols(<span class="st">'C31011 ~ </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(string_cols),data <span class="op">=</span> df).fit()</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 C31011   R-squared:                       1.000
Model:                            OLS   Adj. R-squared:                  1.000
Method:                 Least Squares   F-statistic:                 9.076e+26
Date:                Wed, 24 Apr 2024   Prob (F-statistic):          2.36e-279
Time:                        14:44:14   Log-Likelihood:                 2019.4
No. Observations:                  71   AIC:                            -3939.
Df Residuals:                      21   BIC:                            -3826.
Df Model:                          49                                         
Covariance Type:            nonrobust                                         
=====================================================================================
                        coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------
Intercept          6.698e-18   5.77e-20    116.121      0.000    6.58e-18    6.82e-18
t_cirurgia[T.yes]  9.215e-15   8.06e-14      0.114      0.910   -1.58e-13    1.77e-13
ANO                -7.15e-17   1.16e-16     -0.616      0.544   -3.13e-16     1.7e-16
NORDEM            -1.891e-16   8.19e-16     -0.231      0.820   -1.89e-15    1.51e-15
NUTS2              1.152e-15   1.11e-14      0.104      0.918   -2.19e-14    2.42e-14
C10001             4.163e-17   6.11e-16      0.068      0.946   -1.23e-15    1.31e-15
C21011            -8.882e-15   2.81e-13     -0.032      0.975   -5.94e-13    5.76e-13
C21031            -8.327e-15   2.17e-13     -0.038      0.970    -4.6e-13    4.43e-13
C21041            -3.608e-15   4.53e-14     -0.080      0.937   -9.78e-14    9.06e-14
C21061             1.954e-14   1.68e-13      0.116      0.909   -3.31e-13     3.7e-13
C21081             4.441e-14      1e-12      0.044      0.965   -2.04e-12    2.13e-12
C21091            -1.044e-14   4.39e-13     -0.024      0.981   -9.23e-13    9.02e-13
C21101             1.277e-14   2.11e-13      0.061      0.952   -4.25e-13    4.51e-13
C21111              1.11e-15   1.05e-13      0.011      0.992   -2.17e-13    2.19e-13
C21121             1.658e-15   2.05e-14      0.081      0.936   -4.09e-14    4.42e-14
C21131            -5.884e-15   2.25e-13     -0.026      0.979   -4.74e-13    4.62e-13
C21141             9.104e-15   9.51e-14      0.096      0.925   -1.89e-13    2.07e-13
C21151             1.421e-14   1.42e-13      0.100      0.921   -2.82e-13     3.1e-13
C21161                     0   1.11e-12          0      1.000   -2.31e-12    2.31e-12
C21171             5.357e-15   2.96e-14      0.181      0.858   -5.63e-14     6.7e-14
C21181            -1.454e-14   1.01e-13     -0.144      0.887   -2.25e-13    1.96e-13
C21191              1.61e-15   9.59e-14      0.017      0.987   -1.98e-13    2.01e-13
C21201            -8.549e-15   1.01e-13     -0.084      0.934   -2.19e-13    2.02e-13
C21211            -2.043e-13   7.27e-13     -0.281      0.781   -1.72e-12    1.31e-12
C21221             2.154e-14   2.52e-13      0.085      0.933   -5.03e-13    5.46e-13
C21231             8.327e-15   5.92e-14      0.141      0.889   -1.15e-13    1.31e-13
C21241            -1.332e-15   5.17e-14     -0.026      0.980   -1.09e-13    1.06e-13
C21261             8.527e-14   6.01e-13      0.142      0.888   -1.16e-12    1.33e-12
C21271            -6.661e-15   6.88e-14     -0.097      0.924    -1.5e-13    1.36e-13
C21281            -8.882e-16   2.88e-13     -0.003      0.998      -6e-13    5.98e-13
C21291            -1.565e-14   8.41e-14     -0.186      0.854   -1.91e-13    1.59e-13
C21301            -8.882e-15   1.53e-13     -0.058      0.954   -3.28e-13     3.1e-13
C21311             3.941e-15   5.25e-14      0.075      0.941   -1.05e-13    1.13e-13
C21321              8.66e-15   1.37e-13      0.063      0.950   -2.76e-13    2.93e-13
C21331            -1.193e-15   1.95e-14     -0.061      0.952   -4.17e-14    3.93e-14
C21341            -8.882e-15   8.34e-14     -0.106      0.916   -1.82e-13    1.65e-13
C21351             1.221e-14   5.17e-14      0.236      0.816   -9.54e-14     1.2e-13
C21361            -3.275e-15   4.27e-14     -0.077      0.940    -9.2e-14    8.55e-14
C21371             1.665e-16   2.43e-14      0.007      0.995   -5.03e-14    5.06e-14
C21381             2.408e-15   1.46e-14      0.164      0.871    -2.8e-14    3.29e-14
C21391             6.328e-15   1.22e-13      0.052      0.959   -2.47e-13     2.6e-13
C21401             1.665e-16   4.52e-14      0.004      0.997   -9.38e-14    9.42e-14
C21411            -2.665e-15   2.54e-13     -0.010      0.992   -5.32e-13    5.26e-13
C21441             8.221e-18   4.02e-28   2.05e+10      0.000    8.22e-18    8.22e-18
C22001             4.718e-16   1.89e-14      0.025      0.980   -3.89e-14    3.98e-14
C31001                1.0000   4.42e-14   2.26e+13      0.000       1.000       1.000
C31021               -1.0000    5.1e-14  -1.96e+13      0.000      -1.000      -1.000
C31031               -1.0000   2.89e-14  -3.46e+13      0.000      -1.000      -1.000
C31041               -1.0000   4.51e-14  -2.22e+13      0.000      -1.000      -1.000
C31051               -1.0000   6.88e-14  -1.45e+13      0.000      -1.000      -1.000
C31061               -1.0000   5.38e-14  -1.86e+13      0.000      -1.000      -1.000
C31071               -1.0000   7.16e-14   -1.4e+13      0.000      -1.000      -1.000
==============================================================================
Omnibus:                       36.508   Durbin-Watson:                   1.033
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               86.351
Skew:                          -1.722   Prob(JB):                     1.77e-19
Kurtosis:                       7.162   Cond. No.                     2.14e+19
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 7.24e-31. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>a variável C31001 permite construir Y directamente!</p>
</div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span><span class="st">'C31001'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21081</th>
<th data-quarto-table-cell-role="th">C21091</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C21441</th>
<th data-quarto-table-cell-role="th">C22001</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
<th data-quarto-table-cell-role="th">C31011</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>2.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>4.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>yes</td>
<td>8.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>no</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>yes</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>7.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>yes</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>yes</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 51 columns</p>
</div>
</div>
</div>
<p>e voltamos a fazer o modelo</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>string_cols <span class="op">=</span> <span class="st">' + '</span>.join(df.columns[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> smf.ols(<span class="st">'C31011 ~ </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(string_cols),data <span class="op">=</span> df).fit()</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(est.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 C31011   R-squared:                       0.988
Model:                            OLS   Adj. R-squared:                  0.963
Method:                 Least Squares   F-statistic:                     39.38
Date:                Wed, 24 Apr 2024   Prob (F-statistic):           1.05e-13
Time:                        14:44:14   Log-Likelihood:                -55.748
No. Observations:                  71   AIC:                             209.5
Df Residuals:                      22   BIC:                             320.4
Df Model:                          48                                         
Covariance Type:            nonrobust                                         
=====================================================================================
                        coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------
Intercept           6.22e-07   2.44e-07      2.544      0.018    1.15e-07    1.13e-06
t_cirurgia[T.yes]    -0.4189      0.378     -1.108      0.280      -1.203       0.365
ANO                   0.0013      0.000      2.544      0.018       0.000       0.002
NORDEM               -0.0108      0.003     -3.364      0.003      -0.017      -0.004
NUTS2                -0.0718      0.051     -1.399      0.176      -0.178       0.035
C10001                0.0082      0.002      3.480      0.002       0.003       0.013
C21011                4.9274      0.857      5.750      0.000       3.150       6.705
C21031               -2.0528      0.951     -2.159      0.042      -4.024      -0.081
C21041                0.2306      0.213      1.084      0.290      -0.211       0.672
C21061               -1.6767      0.730     -2.298      0.031      -3.190      -0.164
C21081                8.8434      4.456      1.985      0.060      -0.397      18.084
C21091               -7.3059      1.433     -5.097      0.000     -10.278      -4.333
C21101               -1.4882      0.965     -1.542      0.137      -3.490       0.514
C21111               -1.0788      0.451     -2.394      0.026      -2.013      -0.144
C21121               -0.1928      0.090     -2.150      0.043      -0.379      -0.007
C21131                1.5267      1.035      1.475      0.154      -0.619       3.673
C21141                0.2519      0.456      0.553      0.586      -0.693       1.197
C21151               -2.7579      0.354     -7.788      0.000      -3.492      -2.023
C21161                6.1177      5.197      1.177      0.252      -4.660      16.895
C21171               -0.3612      0.120     -2.998      0.007      -0.611      -0.111
C21181                0.4058      0.480      0.845      0.407      -0.590       1.402
C21191               -0.3214      0.457     -0.703      0.490      -1.270       0.627
C21201                0.3619      0.482      0.750      0.461      -0.638       1.362
C21211                5.3379      3.315      1.610      0.122      -1.537      12.213
C21221               -2.4970      1.093     -2.285      0.032      -4.763      -0.231
C21231               -0.8779      0.215     -4.077      0.000      -1.324      -0.431
C21241                0.5824      0.216      2.692      0.013       0.134       1.031
C21261               -2.2529      2.856     -0.789      0.439      -8.176       3.670
C21271                0.4035      0.320      1.259      0.221      -0.261       1.068
C21281                0.1880      1.389      0.135      0.894      -2.692       3.068
C21291                1.1723      0.320      3.668      0.001       0.510       1.835
C21301               -0.0261      0.739     -0.035      0.972      -1.558       1.506
C21311               -0.5173      0.228     -2.272      0.033      -0.989      -0.045
C21321                0.1573      0.659      0.239      0.814      -1.209       1.524
C21331                0.1142      0.091      1.259      0.221      -0.074       0.302
C21341                0.6779      0.375      1.806      0.085      -0.101       1.457
C21351               -0.4512      0.230     -1.959      0.063      -0.929       0.026
C21361                0.8000      0.115      6.943      0.000       0.561       1.039
C21371                0.1325      0.114      1.167      0.256      -0.103       0.368
C21381               -0.2458      0.047     -5.195      0.000      -0.344      -0.148
C21391                0.0751      0.588      0.128      0.899      -1.145       1.295
C21401               -0.2867      0.209     -1.370      0.185      -0.721       0.147
C21411               -4.0923      0.862     -4.748      0.000      -5.880      -2.305
C21441              2.62e-15   7.57e-16      3.459      0.002    1.05e-15    4.19e-15
C22001               -0.2374      0.076     -3.129      0.005      -0.395      -0.080
C31021                0.0500      0.102      0.490      0.629      -0.162       0.262
C31031               -0.4693      0.082     -5.756      0.000      -0.638      -0.300
C31041                0.0147      0.020      0.731      0.473      -0.027       0.057
C31051                0.2098      0.209      1.006      0.326      -0.223       0.642
C31061                0.1607      0.079      2.047      0.053      -0.002       0.324
C31071                0.4654      0.147      3.158      0.005       0.160       0.771
==============================================================================
Omnibus:                        3.460   Durbin-Watson:                   2.030
Prob(Omnibus):                  0.177   Jarque-Bera (JB):                3.515
Skew:                          -0.073   Prob(JB):                        0.172
Kurtosis:                       4.080   Cond. No.                     2.30e+19
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 6.28e-31. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.</code></pre>
</div>
</div>
<section id="regressão-com-scikit" class="level4" data-number="5.3.1.1">
<h4 data-number="5.3.1.1" class="anchored" data-anchor-id="regressão-com-scikit"><span class="header-section-number">5.3.1.1</span> Regressão com Scikit</h4>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">C21081</th>
<th data-quarto-table-cell-role="th">C21091</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C22001</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>2.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>4.0</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>0.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>7.0</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>yes</td>
</tr>
</tbody>
</table>

<p>5 rows × 52 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seleciona para remover as colunas ano e ordem</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>to_drop <span class="op">=</span> [<span class="st">'ANO'</span>,<span class="st">'NORDEM'</span>]</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span>to_drop, axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># drop das colunas ano e ordem</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df.dropna() <span class="co"># drop das linhas com valores missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a variável target e as features</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">'C31011'</span>])</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">'C31011'</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Typecast da coluna para categoria em pandas</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>X[<span class="st">'NUTS2'</span>] <span class="op">=</span> pd.Categorical(X.NUTS2)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co">#X.dtypes</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>(71, 49)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cria variáveis dummy e faz drop da baseline</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, drop_first <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>(71, 54)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold <span class="co"># Feature selector</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>thresholder <span class="op">=</span> VarianceThreshold(threshold<span class="op">=</span><span class="fl">.2</span>) <span class="co"># define o threshold de variância </span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> thresholder.fit_transform(X) <span class="co"># aplica o threshold para excluir variáveis com baixa variância</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>(71, 45)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Split data for machine learning</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X,  y, test_size <span class="op">=</span> <span class="fl">0.2</span> ,random_state <span class="op">=</span> <span class="dv">2002</span>)</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(56, 45)
(15, 45)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler().fit(X_train) <span class="co"># escalar os dados em pre-processamento</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>scaler.mean_</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>scaler.scale_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>array([8.74428584e+02, 2.52133751e+00, 1.33618689e+00, 6.04110072e+00,
       2.07849779e+00, 9.99840549e-01, 1.31852964e+00, 2.49463711e+00,
       3.02772057e+00, 1.94667430e+00, 2.03155904e+00, 3.17756806e+00,
       9.61303258e+00, 2.59414569e+00, 1.79275398e+00, 2.14991398e+00,
       6.67914436e-01, 1.98198198e+00, 3.08634253e+00, 7.65777916e-01,
       3.85710152e+00, 2.14575697e+00, 3.19473219e+00, 1.56817846e+00,
       4.09205302e+00, 2.73115061e+00, 5.38442458e+00, 2.92197646e+00,
       5.15425325e+00, 1.15123603e+01, 6.52663304e+00, 8.26658429e+00,
       9.99362041e-01, 4.31888207e+00, 2.01777813e+00, 7.27395322e+00,
       2.81339215e+01, 1.19658848e+01, 6.17888108e+00, 4.58535824e+00,
       1.65205114e+00, 4.30397894e+00, 2.98160816e+00, 4.42842742e-01,
       4.79157424e-01])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.transform(X_train)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>X_train</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>X_scaled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>array([[ 5.24932601,  4.75937868,  4.12955491, ..., -0.48511692,
        -0.60485838, -1.34164079],
       [-0.4012212 , -0.39661489, -0.3608349 , ..., -0.14972744,
        -0.60485838,  0.74535599],
       [ 1.30961034,  1.18984467, -0.3608349 , ...,  1.52721994,
        -0.60485838,  0.74535599],
       ...,
       [-0.52930484, -0.39661489, -0.3608349 , ..., -0.48511692,
        -0.60485838,  0.74535599],
       [-0.1702132 , -0.39661489, -0.3608349 , ...,  0.18566203,
        -0.60485838,  0.74535599],
       [-0.70427625, -0.39661489, -0.3608349 , ..., -0.14972744,
         1.65327957, -1.34164079]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression </span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression()</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>lr.fit(X_scaled,y_train) <span class="co"># treina o modelo</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>lr.coef_</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr.predict(X_test) <span class="co"># faz a previsão mas não com os dados escalados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>r2_score(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<pre><code>-45066.183733734906</code></pre>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, <span class="st">"is_categorical_dtype"</span>)</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, <span class="st">"use_inf_as_na"</span>)</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span> y_test, y<span class="op">=</span> y_pred)</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1000</span>)</span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Predictions"</span>)</span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"y_test"</span>)</span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y_pred"</span>)</span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-143-output-1.png" width="982" height="523"></p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>fizemos o <code>scale</code> dos dados de train mas não dos dados de teste.</p>
</div>
</div>
<p>Vamos tentar de outra forma</p>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a variável target e os predictors</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>X_2nd <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">'C31011'</span>])</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>y_2nd <span class="op">=</span> df1[<span class="st">'C31011'</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Typecast da coluna para categoria em pandas</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>X_2nd[<span class="st">'NUTS2'</span>] <span class="op">=</span> pd.Categorical(X_2nd.NUTS2)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cria variáveis dummy e faz drop da baseline</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>X_2nd <span class="op">=</span> pd.get_dummies(X_2nd, drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split data for machine learning</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>X_2nd_train, X_2nd_test, y_2nd_train, y_2nd_test <span class="op">=</span> train_test_split(X_2nd,  y_2nd, test_size <span class="op">=</span> <span class="fl">0.2</span> ,random_state <span class="op">=</span> <span class="dv">2002</span>)</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_2nd_train.shape)</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_2nd_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(56, 54)
(15, 54)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>lr2 <span class="op">=</span> LinearRegression()</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>lr2.fit(X_2nd_train,y_2nd_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>lr2.coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>array([-1.94368049e-16,  1.15740750e-14,  3.65124597e-14, -5.35682609e-14,
        4.23966418e-14,  1.88377092e-13, -1.38195011e-12, -2.77805556e-13,
        1.91402449e-13,  2.22044605e-15,  4.28074243e-13, -3.64153152e-14,
       -6.58084698e-14, -6.10952261e-13,  8.82627305e-15, -8.14626144e-15,
        3.89965837e-14,  2.38975506e-14, -5.86435414e-13, -1.49324997e-13,
       -5.03069808e-16,  5.49560397e-15, -6.99412750e-13,  8.01858580e-14,
        4.98212582e-13, -1.86101135e-14, -2.15188978e-13,  7.42461648e-16,
       -2.53824739e-14,  8.99280650e-15,  1.99840144e-15,  3.91700561e-14,
       -3.00454106e-15,  1.96093142e-14, -6.99440506e-15,  4.83502127e-14,
        1.44051437e-14,  2.33799091e-13, -5.55111512e-17,  7.66053887e-15,
        1.00000000e+00, -1.00000000e+00, -1.00000000e+00, -1.00000000e+00,
       -1.00000000e+00, -1.00000000e+00, -1.00000000e+00, -1.99840144e-15,
        2.41404119e-14,  4.50056659e-14, -1.65222003e-13,  3.51866106e-13,
       -2.44946424e-12,  1.95815586e-14])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>y_2nd_pred <span class="op">=</span> lr2.predict(X_2nd_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we choose the x axis as index, chossing year will give a discrete plot</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span> y_2nd_test, y<span class="op">=</span> y_2nd_pred)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">2</span>, <span class="dv">20</span>)</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">2</span>, <span class="dv">20</span>)</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Predictions"</span>)</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"y_test"</span>)</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y_pred"</span>)</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-150-output-1.png" width="984" height="523"></p>
</div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>y_2nd_test</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>y_2nd_pred</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>r2_score(y_2nd_test, y_2nd_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>1.0</code></pre>
</div>
</div>
<p>temos de excluir C31001!!</p>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define a variável target e os predictors</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>X_3rd <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">'C31011'</span>, <span class="st">'C31001'</span>])</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>y_3rd <span class="op">=</span> df1[<span class="st">'C31011'</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Typecast da coluna para categoria em pandas</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>X_3rd[<span class="st">'NUTS2'</span>] <span class="op">=</span> pd.Categorical(X_3rd.NUTS2)</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cria variáveis dummy e faz drop da baseline</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>X_3rd <span class="op">=</span> pd.get_dummies(X_3rd, drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split data for machine learning</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>X_3rd_train, X_3rd_test, y_3rd_train, y_3rd_test <span class="op">=</span> train_test_split(X_3rd,  y_3rd, test_size <span class="op">=</span> <span class="fl">0.2</span> ,random_state <span class="op">=</span> <span class="dv">2002</span>)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_3rd_train.shape)</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_3rd_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(56, 53)
(15, 53)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>lr3 <span class="op">=</span> LinearRegression()</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>lr3.fit(X_3rd_train,y_3rd_train)</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>lr3.coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<pre><code>array([-2.89065165e-03,  5.41320479e+00,  7.52508894e+00, -2.51991314e+00,
       -1.38806027e+00,  3.89513026e+01, -6.38321113e+01, -1.85914497e+01,
        1.39598080e+01,  1.13122965e-01,  2.48179866e+01,  2.76124915e+00,
       -9.72914071e+00,  1.57918396e+01,  8.85392279e-01,  1.35181584e+00,
        1.49772845e-01,  1.77607406e+00, -2.73519188e+01, -1.50593912e+01,
        1.73988830e-01,  1.28398713e+00, -1.93473069e+01,  3.98023055e+00,
        1.29523386e+01, -3.31543616e+00, -1.49145538e+01, -3.28300461e-02,
       -2.80431048e+00,  7.84716044e-01,  1.85229891e+00,  2.71964178e+00,
       -2.34258012e-01,  9.26484042e-01, -4.03718916e-01, -8.32495907e-01,
        1.32607411e+00, -1.49737685e+00, -3.09974268e-13,  5.15923351e-01,
       -8.48951953e-01, -1.25860009e-01,  1.97142581e-01, -2.58385488e-01,
       -4.37086520e-02, -1.17080763e-01, -3.85317775e+00,  4.22138930e-01,
        1.70055611e+00, -7.94168448e+00,  8.94329198e+00, -1.63172288e+02,
        1.23030119e+00])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>y_3rd_pred <span class="op">=</span> lr3.predict(X_3rd_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>r2_score(y_3rd_test, y_3rd_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<pre><code>-816.2729091067487</code></pre>
</div>
</div>
</section>
<section id="avaliação-dos-modelos-de-regressão" class="level4" data-number="5.3.1.2">
<h4 data-number="5.3.1.2" class="anchored" data-anchor-id="avaliação-dos-modelos-de-regressão"><span class="header-section-number">5.3.1.2</span> Avaliação dos modelos de regressão</h4>
<div class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error, mean_absolute_error, median_absolute_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"                   MAE             MSE           RMSE          MedAE         R2"</span>)</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     1ª Tentativa </span><span class="sc">{:.12f}</span><span class="st"> </span><span class="sc">{:.10f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st">"</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">format</span>(mean_absolute_error(y_test, y_pred),</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_test,y_pred),</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_test,y_pred,squared<span class="op">=</span><span class="va">False</span>), <span class="co"># dá a raiz quadrada do MSE</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>                median_absolute_error(y_test,y_pred),</span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>                r2_score(y_test,y_pred)))</span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     2º Tentativa: </span><span class="sc">{:.12f}</span><span class="st"> </span><span class="sc">{:.10f}</span><span class="st"> </span><span class="sc">{:.10f}</span><span class="st"> </span><span class="sc">{:.10f}</span><span class="st"> </span><span class="sc">{:.12f}</span><span class="st">"</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">format</span>(mean_absolute_error(y_2nd_test, y_2nd_pred),</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_2nd_test,y_2nd_pred),</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_2nd_test,y_2nd_pred,squared<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>                median_absolute_error(y_2nd_test,y_2nd_pred),</span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>                r2_score(y_2nd_test,y_2nd_pred)))</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     3º Tentativa: </span><span class="sc">{:.11f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st"> </span><span class="sc">{:.8f}</span><span class="st">"</span></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">format</span>(mean_absolute_error(y_3rd_test, y_3rd_pred),</span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_3rd_test,y_3rd_pred),</span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>                mean_squared_error(y_3rd_test,y_3rd_pred,squared<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>                median_absolute_error(y_3rd_test,y_3rd_pred),</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>                r2_score(y_3rd_test,y_3rd_pred)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   MAE             MSE           RMSE          MedAE         R2
     1ª Tentativa 553.426660102141 603699.9634376756 776.98131473 364.80029201 -45066.18373373
     2º Tentativa: 0.000000000001 0.0000000000 0.0000000000 0.0000000000 1.000000000000
     3º Tentativa: 48.28875523857 10947.82465799 104.63185298 5.86979198 -816.27290911</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>o valor negativo de R2 indica que o modelo é pior que um modelo constante</p>
</div>
</div>
</section>
<section id="gravar-o-modelo" class="level4" data-number="5.3.1.3">
<h4 data-number="5.3.1.3" class="anchored" data-anchor-id="gravar-o-modelo"><span class="header-section-number">5.3.1.3</span> Gravar o modelo</h4>
<div class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co"># escolher o nome do ficheiro</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"data\linearRegression_SK.pickle"</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="co"># gravar o modelo</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>pickle.dump(lr3, <span class="bu">open</span>(filename, <span class="st">"wb"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fazer load do modelo</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>loaded_model <span class="op">=</span> pickle.load(<span class="bu">open</span>(filename, <span class="st">"rb"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ve rificar que conseguimos carregar o modelo gravado</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>loaded_model.coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="classificação" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="classificação"><span class="header-section-number">5.3.2</span> Classificação</h3>
<p><strong>QUESTÃO</strong>:<br>
Com este conjunto de dados que inclui o número de médicos e enfermeiros em várias especialidades será que consigo estimar se essa unidade em particular tem serviço de cirurgia?</p>
<p>Coluna <strong>t_cirurgia</strong> criada a partir da coluna <strong>C21071</strong> que deve ser retirada depois de criada a etiqueta.</p>
<section id="classification-trees" class="level4" data-number="5.3.2.1">
<h4 data-number="5.3.2.1" class="anchored" data-anchor-id="classification-trees"><span class="header-section-number">5.3.2.1</span> Classification Trees</h4>
<div class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>datadir<span class="sc">}{</span>filename<span class="sc">}</span><span class="ss">"</span>, index_col<span class="op">=</span><span class="dv">0</span>, verbose <span class="op">=</span> <span class="va">False</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>df_hosp.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="154">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">C21061</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>no</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>0.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>13.0</td>
<td>13.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>yes</td>
</tr>
</tbody>
</table>

<p>5 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>df_hosp <span class="op">=</span> df_hosp.reset_index() <span class="co"># </span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df_hosp.drop(columns<span class="op">=</span><span class="st">'C21071'</span>, axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># drop da coluna C21071</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'t_cirurgia'</span>] <span class="op">=</span> df[<span class="st">'t_cirurgia'</span>].fillna(<span class="dv">0</span>) <span class="co"># preencher os missing values com 0</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'t_cirurgia'</span>] <span class="op">=</span> df[<span class="st">'t_cirurgia'</span>].replace({<span class="st">'yes'</span>: <span class="dv">1</span>, <span class="st">'no'</span>: <span class="dv">0</span>}) <span class="co"># substituir os valores yes e no por 1 e 0</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012.0</td>
<td>229.0</td>
<td>17.0</td>
<td>1458.0</td>
<td>247.0</td>
<td>159.00</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>5.0</td>
<td>...</td>
<td>39.0</td>
<td>8.0</td>
<td>19.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>454.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012.0</td>
<td>206.0</td>
<td>17.0</td>
<td>144.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>46.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012.0</td>
<td>65.0</td>
<td>16.0</td>
<td>894.0</td>
<td>111.0</td>
<td>38.25</td>
<td>0.0</td>
<td>8.0</td>
<td>0.0</td>
<td>5.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>337.0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2012.0</td>
<td>106.0</td>
<td>17.0</td>
<td>801.0</td>
<td>166.0</td>
<td>108.00</td>
<td>0.0</td>
<td>12.0</td>
<td>0.0</td>
<td>7.0</td>
<td>...</td>
<td>36.0</td>
<td>4.0</td>
<td>16.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>7.0</td>
<td>0.0</td>
<td>228.0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2012.0</td>
<td>209.0</td>
<td>11.0</td>
<td>221.0</td>
<td>13.0</td>
<td>13.00</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>6.0</td>
<td>0.0</td>
<td>80.0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>5 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df.dropna() <span class="co"># drop das linhas com valores missing</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>df1.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ANO</th>
<th data-quarto-table-cell-role="th">NORDEM</th>
<th data-quarto-table-cell-role="th">NUTS2</th>
<th data-quarto-table-cell-role="th">C10001</th>
<th data-quarto-table-cell-role="th">C20001</th>
<th data-quarto-table-cell-role="th">C21001</th>
<th data-quarto-table-cell-role="th">C21011</th>
<th data-quarto-table-cell-role="th">C21021</th>
<th data-quarto-table-cell-role="th">C21031</th>
<th data-quarto-table-cell-role="th">C21041</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">C31001</th>
<th data-quarto-table-cell-role="th">C31011</th>
<th data-quarto-table-cell-role="th">C31021</th>
<th data-quarto-table-cell-role="th">C31031</th>
<th data-quarto-table-cell-role="th">C31041</th>
<th data-quarto-table-cell-role="th">C31051</th>
<th data-quarto-table-cell-role="th">C31061</th>
<th data-quarto-table-cell-role="th">C31071</th>
<th data-quarto-table-cell-role="th">C32001</th>
<th data-quarto-table-cell-role="th">t_cirurgia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>86.0</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>...</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
<td>86.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2012.0</td>
<td>118.081395</td>
<td>14.976744</td>
<td>642.744186</td>
<td>113.872093</td>
<td>73.979651</td>
<td>0.813953</td>
<td>6.941860</td>
<td>0.360465</td>
<td>2.953488</td>
<td>...</td>
<td>22.941860</td>
<td>3.127907</td>
<td>6.220930</td>
<td>4.476744</td>
<td>3.465116</td>
<td>0.965116</td>
<td>3.465116</td>
<td>1.220930</td>
<td>189.348837</td>
<td>0.488372</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.0</td>
<td>68.264230</td>
<td>3.620129</td>
<td>809.928453</td>
<td>172.413511</td>
<td>108.256016</td>
<td>2.144825</td>
<td>10.384779</td>
<td>1.146994</td>
<td>5.346592</td>
<td>...</td>
<td>26.911775</td>
<td>4.752204</td>
<td>10.678622</td>
<td>5.740930</td>
<td>8.559409</td>
<td>1.482825</td>
<td>4.421066</td>
<td>2.783993</td>
<td>240.396475</td>
<td>0.502797</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>2012.0</td>
<td>3.000000</td>
<td>11.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2012.0</td>
<td>57.500000</td>
<td>11.000000</td>
<td>120.250000</td>
<td>7.750000</td>
<td>6.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>3.250000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>30.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2012.0</td>
<td>119.000000</td>
<td>16.000000</td>
<td>338.500000</td>
<td>42.500000</td>
<td>33.000000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>10.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>0.000000</td>
<td>85.500000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2012.0</td>
<td>175.750000</td>
<td>17.000000</td>
<td>872.500000</td>
<td>162.500000</td>
<td>115.500000</td>
<td>0.000000</td>
<td>10.750000</td>
<td>0.000000</td>
<td>3.750000</td>
<td>...</td>
<td>35.750000</td>
<td>4.000000</td>
<td>11.000000</td>
<td>6.000000</td>
<td>3.000000</td>
<td>1.000000</td>
<td>5.000000</td>
<td>1.000000</td>
<td>282.250000</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>2012.0</td>
<td>229.000000</td>
<td>30.000000</td>
<td>5325.000000</td>
<td>1161.000000</td>
<td>719.000000</td>
<td>13.000000</td>
<td>51.000000</td>
<td>6.000000</td>
<td>31.000000</td>
<td>...</td>
<td>103.000000</td>
<td>21.000000</td>
<td>50.000000</td>
<td>28.000000</td>
<td>72.000000</td>
<td>6.000000</td>
<td>19.000000</td>
<td>15.000000</td>
<td>1515.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>8 rows × 62 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conta o nº de diferentes valores na coluna</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'t_cirurgia'</span>].nunique()</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="co"># verifica se há nulos no dataframe</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>df1.isnull().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>ANO           False
NORDEM        False
NUTS2         False
C10001        False
C20001        False
              ...  
C31051        False
C31061        False
C31071        False
C32001        False
t_cirurgia    False
Length: 62, dtype: bool</code></pre>
</div>
</div>
<section id="information-gain---entropia" class="level5" data-number="5.3.2.1.1">
<h5 data-number="5.3.2.1.1" class="anchored" data-anchor-id="information-gain---entropia"><span class="header-section-number">5.3.2.1.1</span> Information Gain - Entropia</h5>
<div class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># função para calcular a entropia</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_impurity(feature, impurity_criterion): <span class="co"># função para calcular a impureza de uma feature</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="co">    This function calculates impurity of a feature.</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Supported impurity criteria: 'entropy', 'gini'</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co">    input: feature (this needs to be a Pandas series)</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="co">    output: feature impurity</span></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> feature.value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> impurity_criterion <span class="op">==</span> <span class="st">'entropy'</span>:</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>        impurity <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> np.<span class="bu">sum</span>(np.log2(probs) <span class="op">*</span> probs)</span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> impurity_criterion <span class="op">==</span> <span class="st">'gini'</span>:</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>        impurity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">sum</span>(np.square(probs))</span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Unknown impurity criterion'</span>)</span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="bu">round</span>(impurity, <span class="dv">3</span>))</span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplos</span></span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'impurity using entropy:'</span>, compute_impurity(df1[<span class="st">'t_cirurgia'</span>], <span class="st">'entropy'</span>))</span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'impurity using gini index:'</span>, compute_impurity(df1[<span class="st">'t_cirurgia'</span>], <span class="st">'gini'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>impurity using entropy: 1.0
impurity using gini index: 0.5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level <span class="kw">in</span> df1[<span class="st">'NUTS2'</span>].unique(): <span class="co"># loop sobre os níveis da feature NUTS2</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'level name:'</span>, level)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>    df_feature_level <span class="op">=</span> df1[df1[<span class="st">'NUTS2'</span>]<span class="op">==</span> level]</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'corresponding data partition:'</span>)</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df_feature_level.head(<span class="dv">5</span>))</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'partition target feature impurity:'</span>, compute_impurity(df_feature_level[<span class="st">'t_cirurgia'</span>], <span class="st">'entropy'</span>))</span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'partition weight:'</span>, <span class="bu">str</span>(<span class="bu">len</span>(df_feature_level)) <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">len</span>(df1)))</span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'===================='</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>level name: 17.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
0   2012.0   229.0   17.0  1458.0   247.0   159.0     2.0    11.0     0.0   
1   2012.0   206.0   17.0   144.0     0.0     0.0     0.0     0.0     0.0   
3   2012.0   106.0   17.0   801.0   166.0   108.0     0.0    12.0     0.0   
21  2012.0   151.0   17.0  2587.0   529.0   337.0     3.0    32.0     0.0   
27  2012.0    12.0   17.0    71.0     7.0     7.0     0.0     0.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
0      5.0  ...    39.0     8.0    19.0     2.0     2.0     3.0     5.0   
1      0.0  ...     0.0     0.0     0.0     0.0     0.0     0.0     0.0   
3      7.0  ...    36.0     4.0    16.0     5.0     2.0     2.0     7.0   
21    14.0  ...    40.0     8.0    11.0     6.0     3.0     0.0     0.0   
27     0.0  ...     4.0     0.0     0.0     0.0     4.0     0.0     0.0   

    C31071  C32001  t_cirurgia  
0      0.0   454.0           1  
1      0.0    46.0           0  
3      0.0   228.0           1  
21    12.0   793.0           0  
27     0.0     8.0           1  

[5 rows x 62 columns]
partition target feature impurity: 1.0
partition weight: 20/86
====================
level name: 16.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
2   2012.0    65.0   16.0   894.0   111.0   38.25     0.0     8.0     0.0   
5   2012.0   115.0   16.0  1461.0   246.0  171.00     2.0    20.0     0.0   
6   2012.0   189.0   16.0   136.0    10.0    8.00     0.0     0.0     0.0   
7   2012.0   199.0   16.0  2032.0   483.0  299.00     2.0    30.0     2.0   
11  2012.0    88.0   16.0   190.0    17.0   15.00     0.0     2.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
2      5.0  ...     0.0     0.0     0.0     0.0     0.0     0.0     0.0   
5      6.0  ...    48.0    11.0    21.0     3.0     8.0     1.0     3.0   
6      0.0  ...     5.0     2.0     0.0     1.0     0.0     1.0     1.0   
7     12.0  ...   103.0    21.0    26.0    17.0    18.0     4.0    14.0   
11     2.0  ...    10.0     2.0     0.0     1.0     1.0     1.0     5.0   

    C31071  C32001  t_cirurgia  
2      0.0   337.0           1  
5      1.0   518.0           1  
6      0.0    53.0           1  
7      3.0   577.0           1  
11     0.0    76.0           1  

[5 rows x 62 columns]
partition target feature impurity: 0.99
partition weight: 25/86
====================
level name: 11.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
4   2012.0   209.0   11.0   221.0    13.0    13.0     0.0     0.0     0.0   
8   2012.0    57.0   11.0   586.0    86.0    51.0     0.0     5.0     0.0   
9   2012.0   148.0   11.0   262.0    17.0    13.0     0.0     1.0     0.0   
10  2012.0   124.0   11.0   293.0    36.0    33.0     0.0     4.0     0.0   
20  2012.0    14.0   11.0   392.0    53.0    33.0     0.0     0.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
4      0.0  ...     8.0     0.0     0.0     1.0     0.0     1.0     6.0   
8      0.0  ...    53.0     7.0    12.0    14.0     7.0     4.0     7.0   
9      0.0  ...    17.0     0.0     0.0     7.0     0.0     0.0    10.0   
10     1.0  ...    15.0     4.0     0.0     7.0     0.0     1.0     3.0   
20     0.0  ...    76.0     0.0     0.0     0.0    72.0     2.0     2.0   

    C31071  C32001  t_cirurgia  
4      0.0    80.0           1  
8      2.0   184.0           1  
9      0.0    73.0           0  
10     0.0    91.0           1  
20     0.0    52.0           0  

[5 rows x 62 columns]
partition target feature impurity: 1.0
partition weight: 30/86
====================
level name: 30.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
13  2012.0   205.0   30.0   515.0    83.0    57.0     0.0     0.0     0.0   
14  2012.0   131.0   30.0   169.0     1.0     1.0     0.0     0.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
13     0.0  ...    10.0     0.0     0.0     3.0     2.0     0.0     5.0   
14     0.0  ...     3.0     0.0     0.0     1.0     1.0     0.0     1.0   

    C31071  C32001  t_cirurgia  
13     0.0   187.0           1  
14     0.0    48.0           0  

[2 rows x 62 columns]
partition target feature impurity: 1.0
partition weight: 2/86
====================
level name: 20.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
15  2012.0    41.0   20.0   488.0    46.0    30.0     0.0     3.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
15     2.0  ...    19.0     1.0     8.0     7.0     0.0     0.0     1.0   

    C31071  C32001  t_cirurgia  
15     2.0   107.0           1  

[1 rows x 62 columns]
partition target feature impurity: -0.0
partition weight: 1/86
====================
level name: 18.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
16  2012.0   130.0   18.0   415.0    43.0    34.0     0.0     3.0     0.0   
34  2012.0   105.0   18.0  1359.0   251.0   146.0     2.0    14.0     1.0   
50  2012.0   223.0   18.0  1454.0   273.0   154.0     3.0    11.0     0.0   
53  2012.0   224.0   18.0   800.0    87.0    46.0     0.0     2.0     0.0   
54  2012.0   190.0   18.0   384.0    35.0    30.0     0.0     3.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
16     0.0  ...    12.0     0.0     1.0     5.0     0.0     0.0     0.0   
34     8.0  ...    75.0    14.0    17.0    13.0     9.0     4.0    10.0   
50    10.0  ...    72.0    12.0    18.0    13.0    14.0     2.0    12.0   
53     0.0  ...    36.0     4.0    10.0     3.0    10.0     6.0     3.0   
54     0.0  ...    14.0     1.0     2.0     4.0     1.0     3.0     2.0   

    C31071  C32001  t_cirurgia  
16     6.0   153.0           0  
34     8.0   382.0           0  
50     1.0   411.0           0  
53     0.0   235.0           1  
54     1.0   110.0           1  

[5 rows x 62 columns]
partition target feature impurity: 0.918
partition weight: 6/86
====================
level name: 15.0
corresponding data partition:
       ANO  NORDEM  NUTS2  C10001  C20001  C21001  C21011  C21021  C21031  \
41  2012.0   208.0   15.0   183.0     5.0     5.0     0.0     0.0     0.0   
42  2012.0   164.0   15.0  1391.0   172.0   118.0     1.0    11.0     0.0   

    C21041  ...  C31001  C31011  C31021  C31031  C31041  C31051  C31061  \
41     0.0  ...     0.0     0.0     0.0     0.0     0.0     0.0     0.0   
42     2.0  ...    34.0     9.0    13.0     6.0     4.0     0.0     0.0   

    C31071  C32001  t_cirurgia  
41     0.0    71.0           1  
42     2.0   492.0           1  

[2 rows x 62 columns]
partition target feature impurity: -0.0
partition weight: 2/86
====================</code></pre>
</div>
</div>
<div class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># função para calcular o information gain</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> comp_feature_information_gain(df, target, descriptive_feature, split_criterion): </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co">    This function calculates information gain for splitting on </span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co">    a particular descriptive feature for a given dataset</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and a given impurity criteria.</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Supported split criterion: 'entropy', 'gini'</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'target feature:'</span>, target)</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'descriptive_feature:'</span>, descriptive_feature)</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'split criterion:'</span>, split_criterion)</span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a>    target_entropy <span class="op">=</span> compute_impurity(df[target], split_criterion)</span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'the target entropy is'</span>, target_entropy)</span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we define two lists below:</span></span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># entropy_list to store the entropy of each partition</span></span>
<span id="cb251-19"><a href="#cb251-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># weight_list to store the relative number of observations in each partition</span></span>
<span id="cb251-20"><a href="#cb251-20" aria-hidden="true" tabindex="-1"></a>    entropy_list <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb251-21"><a href="#cb251-21" aria-hidden="true" tabindex="-1"></a>    weight_list <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb251-22"><a href="#cb251-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-23"><a href="#cb251-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop over each level of the descriptive feature</span></span>
<span id="cb251-24"><a href="#cb251-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to partition the dataset with respect to that level</span></span>
<span id="cb251-25"><a href="#cb251-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and compute the entropy and the weight of the level's partition</span></span>
<span id="cb251-26"><a href="#cb251-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level <span class="kw">in</span> df[descriptive_feature].unique():</span>
<span id="cb251-27"><a href="#cb251-27" aria-hidden="true" tabindex="-1"></a>        df_feature_level <span class="op">=</span> df[df[descriptive_feature] <span class="op">==</span> level]</span>
<span id="cb251-28"><a href="#cb251-28" aria-hidden="true" tabindex="-1"></a>        entropy_level <span class="op">=</span> compute_impurity(df_feature_level[target], split_criterion)</span>
<span id="cb251-29"><a href="#cb251-29" aria-hidden="true" tabindex="-1"></a>        entropy_list.append(<span class="bu">round</span>(entropy_level, <span class="dv">3</span>))</span>
<span id="cb251-30"><a href="#cb251-30" aria-hidden="true" tabindex="-1"></a>        weight_level <span class="op">=</span> <span class="bu">len</span>(df_feature_level) <span class="op">/</span> <span class="bu">len</span>(df)</span>
<span id="cb251-31"><a href="#cb251-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'the level is </span><span class="sc">{}</span><span class="st"> and the weight is </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(level, weight_level))</span>
<span id="cb251-32"><a href="#cb251-32" aria-hidden="true" tabindex="-1"></a>        weight_list.append(<span class="bu">round</span>(weight_level, <span class="dv">3</span>))</span>
<span id="cb251-33"><a href="#cb251-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-34"><a href="#cb251-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'impurity of partitions:'</span>, entropy_list)</span>
<span id="cb251-35"><a href="#cb251-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'weights of partitions:'</span>, weight_list)</span>
<span id="cb251-36"><a href="#cb251-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-37"><a href="#cb251-37" aria-hidden="true" tabindex="-1"></a>    feature_remaining_impurity <span class="op">=</span> np.<span class="bu">sum</span>(np.array(entropy_list) <span class="op">*</span> np.array(weight_list))</span>
<span id="cb251-38"><a href="#cb251-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'remaining impurity:'</span>, feature_remaining_impurity)</span>
<span id="cb251-39"><a href="#cb251-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-40"><a href="#cb251-40" aria-hidden="true" tabindex="-1"></a>    information_gain <span class="op">=</span> target_entropy <span class="op">-</span> feature_remaining_impurity</span>
<span id="cb251-41"><a href="#cb251-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'information gain:'</span>, information_gain)</span>
<span id="cb251-42"><a href="#cb251-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-43"><a href="#cb251-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'===================='</span>)</span>
<span id="cb251-44"><a href="#cb251-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-45"><a href="#cb251-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(information_gain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos ver que a variável do Número de Pessoal ao Serviço - Total <strong>C10001</strong> é bastante promissora para faser a divisão do espaço, e a variável do Número de Médicos - Total <strong>C20001</strong> é bastante melhor do que o Número de Médicos - Especialistas - Anatomia Patológica - Total <strong>C21011</strong></p>
<div class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>split_criterion <span class="op">=</span> <span class="st">'entropy'</span> <span class="co"># escolher o critério de divisão</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature <span class="kw">in</span> df1.drop(columns<span class="op">=</span>[<span class="st">'t_cirurgia'</span>,<span class="st">'ANO'</span>,<span class="st">'NORDEM'</span>]).columns:</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>    feature_info_gain <span class="op">=</span> comp_feature_information_gain(df1, <span class="st">'t_cirurgia'</span>, feature, split_criterion) <span class="co"># calcular o information gain</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="trees" class="level5" data-number="5.3.2.1.2">
<h5 data-number="5.3.2.1.2" class="anchored" data-anchor-id="trees"><span class="header-section-number">5.3.2.1.2</span> trees</h5>
<div class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a variável target e os predictors</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">'t_cirurgia'</span>]) <span class="co"># dataframe sem a coluna target</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">'t_cirurgia'</span>].values <span class="co"># target em formato de array</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">3</span>) <span class="co"># define a profundidade da árvore</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> clf.fit(X,y) <span class="co"># treina o modelo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn import tree</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>text_representation <span class="op">=</span> tree.export_text(clf)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(text_representation) <span class="co"># visualização do modelo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_58 &lt;= 1.50
|   |--- feature_48 &lt;= 0.50
|   |   |--- feature_20 &lt;= 1.00
|   |   |   |--- class: 0
|   |   |--- feature_20 &gt;  1.00
|   |   |   |--- class: 1
|   |--- feature_48 &gt;  0.50
|   |   |--- feature_1 &lt;= 179.50
|   |   |   |--- class: 0
|   |   |--- feature_1 &gt;  179.50
|   |   |   |--- class: 1
|--- feature_58 &gt;  1.50
|   |--- feature_60 &lt;= 73.50
|   |   |--- feature_51 &lt;= 57.50
|   |   |   |--- class: 1
|   |   |--- feature_51 &gt;  57.50
|   |   |   |--- class: 0
|   |--- feature_60 &gt;  73.50
|   |   |--- feature_58 &lt;= 9.50
|   |   |   |--- class: 1
|   |   |--- feature_58 &gt;  9.50
|   |   |   |--- class: 0
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gravar o log da Árvore</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"data\decision_tree.log"</span>, <span class="st">"w"</span>) <span class="im">as</span> fout: <span class="co"># </span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>    fout.write(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="co"># class_names = True em vez da lista  faz print y(0) e y(1)</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">20</span>))</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tree.plot_tree(clf, class_names<span class="op">=</span> [<span class="st">"No"</span>,<span class="st">"Yes"</span>], filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-175-output-1.png" width="1879" height="1498"></p>
</div>
</div>
<div class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gravar a imagem da tree</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"images/decision_tree.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="classification-com-scikit" class="level4" data-number="5.3.2.2">
<h4 data-number="5.3.2.2" class="anchored" data-anchor-id="classification-com-scikit"><span class="header-section-number">5.3.2.2</span> Classification com Scikit</h4>
<div class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold <span class="co"># Feature selector</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline <span class="co"># For setting up pipeline</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> Normalizer, StandardScaler, MinMaxScaler, PowerTransformer, MaxAbsScaler, LabelEncoder <span class="co"># For scaling variables</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split,cross_val_score <span class="co"># For splitting data</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier <span class="co"># For Decision Tree</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For model evaluation</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score,confusion_matrix </span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve,roc_auc_score </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split data for machine learning</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X,  y, </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>                                                    test_size <span class="op">=</span> <span class="fl">0.2</span> ,</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>                                                    random_state <span class="op">=</span> <span class="dv">1984</span>)</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape)</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(68, 61)
(18, 61)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold <span class="co"># Feature selector</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler <span class="co">#for scaling variables</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline <span class="co"># For setting up pipeline</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Define a pipeline</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>(<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>(<span class="st">'selector'</span>, VarianceThreshold()),</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>(<span class="st">'TREE'</span>, DecisionTreeClassifier())])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="usando-a-pipeline" class="level5" data-number="5.3.2.2.1">
<h5 data-number="5.3.2.2.1" class="anchored" data-anchor-id="usando-a-pipeline"><span class="header-section-number">5.3.2.2.1</span> usando a Pipeline</h5>
<div class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> set_config <span class="co"># para configurar a visualização da pipeline</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>set_config(display<span class="op">=</span><span class="st">"diagram"</span>)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('selector', VarianceThreshold()),
                ('TREE', DecisionTreeClassifier())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('selector', VarianceThreshold()),
                ('TREE', DecisionTreeClassifier())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">VarianceThreshold</label><div class="sk-toggleable__content"><pre>VarianceThreshold()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier()</pre></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># execução da pipeline com parameteros de omissão</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>pipeline.fit(X_train, y_train)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Training set score: '</span> <span class="op">+</span> <span class="bu">str</span>(pipeline.score(X_train,y_train)))</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test set score: '</span> <span class="op">+</span> <span class="bu">str</span>(pipeline.score(X_test,y_test)))</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(X_test)</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>y_pred</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>y_proba <span class="op">=</span> pipeline.predict_proba(X_test)</span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a>y_proba</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training set score: 1.0
Test set score: 0.4444444444444444

</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>array([[0., 1.],
       [0., 1.],
       [1., 0.],
       [0., 1.],
       [1., 0.],
       [1., 0.],
       [0., 1.],
       [1., 0.],
       [0., 1.],
       [1., 0.],
       [1., 0.],
       [1., 0.],
       [1., 0.],
       [0., 1.],
       [1., 0.],
       [0., 1.],
       [1., 0.],
       [0., 1.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(cm,columns <span class="op">=</span> [<span class="st">'pred: No'</span>,<span class="st">'pred: Yes'</span>],</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>                   index <span class="op">=</span> [<span class="st">'real: No'</span>,<span class="st">'real: Yes'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pred: No  pred: Yes
real: No          5          5
real: Yes         5          3</code></pre>
</div>
</div>
<div class="cell" data-execution_count="182">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score, recall_score, accuracy_score</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Precision: </span><span class="sc">%.3f</span><span class="st">'</span> <span class="op">%</span> precision_score(y_test, y_pred))</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Recall: </span><span class="sc">%.3f</span><span class="st">'</span> <span class="op">%</span> recall_score(y_test, y_pred))</span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy: </span><span class="sc">%.3f</span><span class="st">'</span> <span class="op">%</span> accuracy_score(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Precision: 0.375
Recall: 0.375
Accuracy: 0.444</code></pre>
</div>
</div>
<p><img src="images/conf_matrix.png" class="img-fluid"></p>
<div class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, balanced_accuracy_score</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="co"># antes era plot_roc_curve</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> RocCurveDisplay</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test,</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>                                       pipeline.predict_proba(X_test)[:,<span class="dv">1</span>],)</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(pipeline, X_test, y_test)</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-184-output-1.png" width="589" height="429"></p>
</div>
</div>
</section>
<section id="sem-pipeline" class="level5" data-number="5.3.2.2.2">
<h5 data-number="5.3.2.2.2" class="anchored" data-anchor-id="sem-pipeline"><span class="header-section-number">5.3.2.2.2</span> sem Pipeline</h5>
<div class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>clf2 <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">2</span>) </span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> clf2.fit(X_train, y_train)</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>y_class <span class="op">=</span> model2.predict(X_test)</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>y_class</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>y_class_proba <span class="op">=</span> model2.predict_proba(X_test)</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a>y_class_proba</span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a>model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a>tree.plot_tree(clf2, class_names<span class="op">=</span> [<span class="st">"No"</span>,<span class="st">"Yes"</span>], filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="173">
<pre><code>[Text(0.5, 0.8333333333333334, 'x[57] &lt;= 0.5\ngini = 0.5\nsamples = 68\nvalue = [34, 34]\nclass = No'),
 Text(0.25, 0.5, 'x[49] &lt;= 0.5\ngini = 0.444\nsamples = 36\nvalue = [24, 12]\nclass = No'),
 Text(0.125, 0.16666666666666666, 'gini = 0.278\nsamples = 18\nvalue = [15, 3]\nclass = No'),
 Text(0.375, 0.16666666666666666, 'gini = 0.5\nsamples = 18\nvalue = [9, 9]\nclass = No'),
 Text(0.75, 0.5, 'x[1] &lt;= 15.5\ngini = 0.43\nsamples = 32\nvalue = [10, 22]\nclass = Yes'),
 Text(0.625, 0.16666666666666666, 'gini = 0.0\nsamples = 4\nvalue = [4, 0]\nclass = No'),
 Text(0.875, 0.16666666666666666, 'gini = 0.337\nsamples = 28\nvalue = [6, 22]\nclass = Yes')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-185-output-3.png" width="540" height="389"></p>
</div>
</div>
<p>podemos mudar o threshold</p>
<div class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> (model2.predict_proba(X_test)[:, <span class="dv">1</span>] <span class="op">&gt;</span> threshold)</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>confusion_matrix(y_test, y_pred)</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>cm_thr70 <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(cm_thr70,columns <span class="op">=</span> [<span class="st">'pred: No'</span>,<span class="st">'pred: Yes'</span>],</span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>                   index <span class="op">=</span> [<span class="st">'real: No'</span>,<span class="st">'real: Yes'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
           pred: No  pred: Yes
real: No          7          3
real: Yes         5          3</code></pre>
</div>
</div>
<div class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve,RocCurveDisplay</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_test,model2.predict_proba(X_test)[:,<span class="dv">1</span>],</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>                                 drop_intermediate<span class="op">=</span><span class="va">False</span>) <span class="co"># temos de fazer o unpack dos 3 resultados</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(model,X_test,y_test)</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="500-mod5_files/figure-html/cell-187-output-1.png" width="589" height="429"></p>
</div>
</div>
<div class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fpr)</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tpr)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(thresholds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.  0.3 0.6 1. ]
[0.    0.375 0.75  1.   ]
[1.78571429 0.78571429 0.5        0.16666667]</code></pre>
</div>
</div>
</section>
<section id="gravar-o-modelo-1" class="level5" data-number="5.3.2.2.3">
<h5 data-number="5.3.2.2.3" class="anchored" data-anchor-id="gravar-o-modelo-1"><span class="header-section-number">5.3.2.2.3</span> gravar o modelo</h5>
<div class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># escolher o nome do ficheiro</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"data\Tree.pickle"</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="co"># gravar o modelo</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>pickle.dump(model2, <span class="bu">open</span>(filename, <span class="st">"wb"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>


</section>
</section>
</section>
</section>

<p><img src="images/ine_logo_secundario_cores_491x57.png" class="img-fluid" style="width:50.0%"></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./400-mod4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programming Tecnhiques (Intermediate)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./600-mod6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualização de Dados Geográficos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>